/groups/wag/pkozlows/miniconda3/envs/pyscf/lib/python3.11/site-packages/pyscf/dft/libxc.py:772: UserWarning: Since PySCF-2.3, B3LYP (and B3P86) are changed to the VWN-RPA variant, the same to the B3LYP functional in Gaussian and ORCA (issue 1480). To restore the VWN5 definition, you can put the setting "B3LYP_WITH_VWN5 = True" in pyscf_conf.py
  warnings.warn('Since PySCF-2.3, B3LYP (and B3P86) are changed to the VWN-RPA variant, '
Discarded 6 diffused primitive functions, 0 contracted functions
#INFO: **** input file is /central/home/pkozlows/ch121b/gan/dft/szv/000/2/szv_0.py ****
# import statements
import pyscf.pbc.tools.pyscf_ase as pyscf_ase
import pyscf.pbc.gto as pbcgto
import pyscf.pbc.dft as pbcdft


from ase.build import bulk
from ase.dft.kpoints import sc_special_points as special_points, get_bandpath

import numpy as np

# ase
c = bulk('GaN', 'wurtzite', a=3.19, c=5.19)

# pyscf specs
cell = pbcgto.Cell()
cell.atom = pyscf_ase.ase_atoms_to_pyscf(c)
cell.a = c.cell
cell.exp_to_discard = 0.1

cell.basis = 'gth-szv'
cell.pseudo = 'gth-pade'
cell.verbose = 5
cell.build()

# define the special points here
points = special_points['hexagonal']
G = points['G']
K = points['K']
M = points['M']
A = points['A']
L = points['L']
H = points['H']

# Choose an appropriate path for the band structure calculation
band_kpts, kpath, sp_points = get_bandpath([G, M, K, G, A, L, H, A], c.cell, npoints=50)
band_kpts = cell.get_abs_kpts(band_kpts)

# dft calculation
mf = pbcdft.RKS(cell)
mf.xc = 'b3pw91'
mf.kernel()

# get the data from the calculation
e_kn_2 = mf.get_bands(band_kpts)[0]
vbmax = -99
for en in e_kn_2:
    vb_k = en[cell.nelectron//2-1]
    if vb_k > vbmax:
        vbmax = vb_k
e_kn_2 = [en - vbmax for en in e_kn_2]

# Saving data to .npy files
np.save('band_kpts.npy', band_kpts)
np.save('kpath.npy', kpath)
np.save('sp_points.npy', sp_points)
np.save('e_kn_2.npy', e_kn_2)
np.save('nbands.npy', cell.nao_nr())







#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='hpc-82-09.cm.cluster', release='3.10.0-1160.25.1.el7.x86_64', version='#1 SMP Wed Apr 28 21:49:45 UTC 2021', machine='x86_64')  Threads 15
Python 3.11.5 (main, Sep 11 2023, 13:54:46) [GCC 11.2.0]
numpy 1.26.0  scipy 1.11.3
Date: Sun Oct 29 22:02:05 2023
PySCF version 2.3.0
PySCF path  /groups/wag/pkozlows/miniconda3/envs/pyscf/lib/python3.11/site-packages/pyscf

[ENV] PYSCF_CONFIG_FILE /home/pkozlows
[CONFIG] conf_file /home/pkozlows/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 360085 
[INPUT] num. atoms = 4
[INPUT] num. electrons = 36
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ga     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT]  2 N     -0.000000000000   1.841747358715   0.643929030186 AA   -0.000000000000   3.480398098612   1.216849510709 Bohr   0.0
[INPUT]  3 Ga    -0.000000000000   1.841747358715   2.595000000000 AA   -0.000000000000   3.480398098612   4.903839293246 Bohr   0.0
[INPUT]  4 N      0.000000000000   0.000000000000   3.238929030186 AA    0.000000000000   0.000000000000   6.120688803955 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ga
[INPUT] 0    0    [5    /1   ]  7.06665397037     0.00403882881
                                3.42836918        -0.04992601521
                                1.43006411438     0.270487560795
                                0.571610928613    0.114461485481
                                0.232196966975    -0.765662388169
[INPUT] 1    0    [5    /1   ]  7.06665397037     0.000167446202
                                3.42836918        0.003362568505
                                1.43006411438     0.130532105798
                                0.571610928613    -0.096032824634
                                0.232196966975    -0.807329497232
[INPUT] 2    0    [5    /1   ]  7.06665397037     -0.311164169605
                                3.42836918        -0.386388805667
                                1.43006411438     -0.341437057173
                                0.571610928613    -0.20460821239
                                0.232196966975    -0.056129936831
[INPUT] N
[INPUT] 0    0    [4    /1   ]  6.1526903413      0.1506300537
                                1.823633228       -0.0360100734
                                0.567662887       -0.6942023212
                                0.1628222852      -0.3878929987
[INPUT] 1    0    [4    /1   ]  6.1526903413      -0.0950603476
                                1.823633228       -0.2918864295
                                0.567662887       -0.473905005
                                0.1628222852      -0.389341867

Ewald components = 6.77773183084737, -128.779455527716, 5.42224205397643
nuclear repulsion = -116.579481642892
number of shells = 10
number of NR pGTOs = 122
number of NR cGTOs = 26
basis = gth-szv
ecp = {}
CPU time:         1.12
lattice vectors  a1 [6.028226337, 0.000000000, 0.000000000]
                 a2 [-3.014113169, 5.220597148, 0.000000000]
                 a3 [0.000000000, 0.000000000, 9.807678586]
dimension = 3
low_dim_ft_type = None
Cell volume = 308.657
exp_to_discard = 0.1
rcut = 18.312728390691518 (nimgs = [4 4 2])
lattice sum = 461 cells
precision = 1e-08
pseudo = gth-pade
ke_cutoff = 887.7119060369721
    = [ 83  83 133] mesh (916237 PWs)
/groups/wag/pkozlows/miniconda3/envs/pyscf/lib/python3.11/site-packages/ase/dft/kpoints.py:357: UserWarning: Please do not use (kpts, x, X) = bandpath(...).  Use path = bandpath(...) and then kpts = path.kpts and (x, X, labels) = path.get_linear_kpoint_axis().
  warnings.warn('Please do not use (kpts, x, X) = bandpath(...).  '


******** <class 'pyscf.pbc.dft.rks.RKS'> ********
method = RKS-KohnShamDFT
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-07
SCF conv_tol_grad = None
SCF max_cycles = 50
direct_scf = False
chkfile to save SCF result = /tmp/tmpsts_pa1o
max_memory 360085 MB (current use 98 MB)
******** PBC SCF flags ********
kpt = [0. 0. 0.]
Exchange divergence treatment (exxdiv) = ewald
Ewald components = 0.00051775335925431, -0.251419253935776, 0.0646100141269025
    madelung (= occupied orbital energy shift) = 0.3725829728992387
    Total energy shift due to Ewald probe charge = -1/2 * Nelec*madelung = -6.70649351219
DF object = <pyscf.pbc.df.fft.FFTDF object at 0x7f65e30497d0>
XC functionals = b3pw91
small_rho_cutoff = 1e-07
Uniform grid, mesh = [ 83  83 133]
<class 'pyscf.pbc.dft.rks.RKS'> does not have attributes  nlcgrids nlc
Set gradient conv threshold to 0.000316228
Initial guess from minao.
Big error detected in the electron number of initial guess density matrix (Ne/cell = 36.0958)!
  This can cause huge error in Fock matrix and lead to instability in SCF for low-dimensional systems.
  DM is normalized wrt the number of electrons 36
    CPU time for setting up grids      5.19 sec, wall time      0.52 sec
nelec by numeric integration = 35.999999997603695
    CPU time for vxc     54.81 sec, wall time      3.93 sec
Building PBC AO integrals incore
Ewald components = 0.00051775335925431, -0.251419253935776, 0.0646100141269025
    CPU time for vj and vk    132.84 sec, wall time     12.40 sec
Ewald components = 6.77773183084737, -128.779455527716, 5.42224205397643
E1 = -88.22425101323415  Ecoul = 61.06099140629755  Exc = -24.98775766815212
init E= -168.730498917981
cond(S) = 7.39940067619044
/groups/wag/pkozlows/miniconda3/envs/pyscf/lib/python3.11/site-packages/pyscf/pbc/gto/cell.py:243: UserWarning: Function cell.dumps drops attribute a because it is not JSON-serializable
  warnings.warn(msg)
    CPU time for initialize scf    250.36 sec, wall time     21.69 sec
  HOMO = 0.24849736506269  LUMO = 0.60218279007077
  mo_energy =
[-0.45980268 -0.37891711 -0.1121286  -0.11172501 -0.11172501 -0.10650459
 -0.10650459 -0.08711158 -0.08711158 -0.08255554 -0.08255554 -0.0691535
 -0.01153989  0.21405011  0.21405011  0.24549055  0.24849737  0.24849737
  0.60218279  0.64857194  0.83034196  0.83034196  0.83655484  0.87798427
  0.87798427  0.89683545]
nelec by numeric integration = 35.9999999985416
    CPU time for vxc     54.69 sec, wall time      3.92 sec
Ewald components = 0.00051775335925431, -0.251419253935776, 0.0646100141269025
    CPU time for vj and vk      0.11 sec, wall time      0.01 sec
Ewald components = 6.77773183084737, -128.779455527716, 5.42224205397643
E1 = -87.80168662527683  Ecoul = 62.872242133475815  Exc = -26.158001263123204
cycle= 1 E= -167.666927397816  delta_E= 1.06  |g|= 1.07  |ddm|= 4.28
    CPU time for cycle= 1     54.94 sec, wall time      3.93 sec
  HOMO = 0.644407938013358  LUMO = 0.829748990825371
  mo_energy =
[-0.30634537 -0.30634537 -0.30574423 -0.30574423 -0.30494008 -0.3018074
 -0.29976464 -0.29976464 -0.29643616 -0.29643616 -0.12854736  0.03496809
  0.14568634  0.51828561  0.51828561  0.6419863   0.64440794  0.64440794
  0.82974899  0.8418884   0.8418884   0.86654874  0.89536306  1.01219697
  1.01219697  1.30099289]
nelec by numeric integration = 35.99999999892721
    CPU time for vxc     54.19 sec, wall time      3.88 sec
Ewald components = 0.00051775335925431, -0.251419253935776, 0.0646100141269025
    CPU time for vj and vk      0.07 sec, wall time      0.01 sec
Ewald components = 6.77773183084737, -128.779455527716, 5.42224205397643
E1 = -87.48429823419798  Ecoul = 61.63794165779422  Exc = -24.85424244031099
cycle= 2 E= -167.280080659607  delta_E= 0.387  |g|= 1.59  |ddm|=  4.2
    CPU time for cycle= 2     54.36 sec, wall time      3.89 sec
  HOMO = 0.465411484759471  LUMO = 0.749575327016685
  mo_energy =
[-0.22149834 -0.21929306 -0.2045202  -0.2045202  -0.20301752 -0.20301752
 -0.20114602 -0.19513871 -0.19513871 -0.19102204 -0.19102204 -0.07564965
  0.10043346  0.38549649  0.38549649  0.45769884  0.45769884  0.46541148
  0.74957533  0.76354321  0.82475606  0.82475606  0.84918422  0.92916682
  0.92916682  1.1103039 ]
nelec by numeric integration = 35.999999998653905
    CPU time for vxc     54.12 sec, wall time      3.88 sec
Ewald components = 0.00051775335925431, -0.251419253935776, 0.0646100141269025
    CPU time for vj and vk      0.07 sec, wall time      0.01 sec
Ewald components = 6.77773183084737, -128.779455527716, 5.42224205397643
E1 = -87.81994481153352  Ecoul = 61.731262913287466  Exc = -25.507568306461096
cycle= 3 E= -168.175731847599  delta_E= -0.896  |g|= 0.0115  |ddm|= 2.45
    CPU time for cycle= 3     54.29 sec, wall time      3.89 sec
  HOMO = 0.455788212209611  LUMO = 0.745174746513459
  mo_energy =
[-0.22698994 -0.22655076 -0.21039557 -0.21039557 -0.2089414  -0.2089414
 -0.20634439 -0.2006668  -0.2006668  -0.196398   -0.196398   -0.08238752
  0.09398081  0.3741016   0.3741016   0.44600441  0.44600441  0.45578821
  0.74517475  0.75896775  0.82262974  0.82262974  0.84707125  0.92621975
  0.92621975  1.10322838]
nelec by numeric integration = 35.999999998653074
    CPU time for vxc     54.48 sec, wall time      3.90 sec
Ewald components = 0.00051775335925431, -0.251419253935776, 0.0646100141269025
    CPU time for vj and vk      0.07 sec, wall time      0.01 sec
Ewald components = 6.77773183084737, -128.779455527716, 5.42224205397643
E1 = -87.81097923087046  Ecoul = 61.719004338094386  Exc = -25.504354170593693
cycle= 4 E= -168.175810706262  delta_E= -7.89e-05  |g|= 0.00251  |ddm|= 0.0294
    CPU time for cycle= 4     54.67 sec, wall time      3.91 sec
  HOMO = 0.456289257886405  LUMO = 0.745420674363547
  mo_energy =
[-0.22728592 -0.22622955 -0.21087035 -0.21087035 -0.20941944 -0.20941944
 -0.20681329 -0.20116531 -0.20116531 -0.196903   -0.196903   -0.08210565
  0.09407157  0.37463011  0.37463011  0.44663668  0.44663668  0.45628926
  0.74542067  0.75920461  0.82255248  0.82255248  0.84704959  0.92627692
  0.92627692  1.10356563]
nelec by numeric integration = 35.999999998653244
    CPU time for vxc     54.77 sec, wall time      3.92 sec
Ewald components = 0.00051775335925431, -0.251419253935776, 0.0646100141269025
    CPU time for vj and vk      0.08 sec, wall time      0.01 sec
Ewald components = 6.77773183084737, -128.779455527716, 5.42224205397643
E1 = -87.81065727459415  Ecoul = 61.71778220655403  Exc = -25.503456504202948
cycle= 5 E= -168.175813215135  delta_E= -2.51e-06  |g|= 0.000368  |ddm|= 0.00403
    CPU time for cycle= 5     54.98 sec, wall time      3.94 sec
  HOMO = 0.456387847072623  LUMO = 0.745447698711817
  mo_energy =
[-0.2272918  -0.22616911 -0.21089128 -0.21089128 -0.20944019 -0.20944019
 -0.20684517 -0.20119295 -0.20119295 -0.19693128 -0.19693128 -0.08205358
  0.09410598  0.3747176   0.3747176   0.44674194  0.44674194  0.45638785
  0.7454477   0.75925675  0.82255472  0.82255472  0.8470464   0.92629951
  0.92629951  1.10364271]
nelec by numeric integration = 35.99999999865327
    CPU time for vxc     54.21 sec, wall time      3.88 sec
Ewald components = 0.00051775335925431, -0.251419253935776, 0.0646100141269025
    CPU time for vj and vk      0.07 sec, wall time      0.01 sec
Ewald components = 6.77773183084737, -128.779455527716, 5.42224205397643
E1 = -87.81064835200655  Ecoul = 61.717619186067594  Exc = -25.503302459701445
cycle= 6 E= -168.175813268532  delta_E= -5.34e-08  |g|= 1.27e-05  |ddm|= 0.000639
    CPU time for cycle= 6     54.38 sec, wall time      3.89 sec
  HOMO = 0.456388304164272  LUMO = 0.745448314429472
  mo_energy =
[-0.22728817 -0.22616926 -0.21088676 -0.21088676 -0.20943573 -0.20943573
 -0.20683986 -0.20118763 -0.20118763 -0.19692589 -0.19692589 -0.08205192
  0.09410676  0.3747179   0.3747179   0.44674215  0.44674215  0.4563883
  0.74544831  0.75925782  0.82255482  0.82255482  0.84704752  0.92629957
  0.92629957  1.10364386]
nelec by numeric integration = 35.999999998653266
    CPU time for vxc     54.32 sec, wall time      3.89 sec
Ewald components = 0.00051775335925431, -0.251419253935776, 0.0646100141269025
    CPU time for vj and vk      0.09 sec, wall time      0.01 sec
Ewald components = 6.77773183084737, -128.779455527716, 5.42224205397643
E1 = -87.81065244505936  Ecoul = 61.71762131802732  Exc = -25.50330049869374
Extra cycle  E= -168.175813268618  delta_E= -8.54e-11  |g|= 5.51e-06  |ddm|= 4.47e-05
    CPU time for scf_cycle    632.50 sec, wall time     49.05 sec
    CPU time for SCF    632.50 sec, wall time     49.05 sec
converged SCF energy = -168.175813268618
nelec by numeric integration = 35.99999999865326
    CPU time for vxc    288.36 sec, wall time     21.10 sec
Ewald components = 0.00051775335925431, -0.251419253935776, 0.0646100141269025
    CPU time for vj and vk  10257.96 sec, wall time   1195.70 sec

WARN: 91.61 error found in overlap integrals. cell.precision  or  cell.rcut  can be adjusted to improve accuracy.

Traceback (most recent call last):
  File "/central/home/pkozlows/ch121b/gan/dft/szv/000/2/szv_0.py", line 45, in <module>
    e_kn_2 = mf.get_bands(band_kpts)[0]
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/groups/wag/pkozlows/miniconda3/envs/pyscf/lib/python3.11/site-packages/pyscf/pbc/scf/hf.py", line 188, in get_bands
    e, c = mf.eig(fock[k], s1e[k])
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/groups/wag/pkozlows/miniconda3/envs/pyscf/lib/python3.11/site-packages/pyscf/scf/hf.py", line 1545, in eig
    return self._eigh(h, s)
           ^^^^^^^^^^^^^^^^
  File "/groups/wag/pkozlows/miniconda3/envs/pyscf/lib/python3.11/site-packages/pyscf/scf/hf.py", line 1537, in _eigh
    return eig(h, s)
           ^^^^^^^^^
  File "/groups/wag/pkozlows/miniconda3/envs/pyscf/lib/python3.11/site-packages/pyscf/scf/hf.py", line 1183, in eig
    e, c = scipy.linalg.eigh(h, s)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/groups/wag/pkozlows/miniconda3/envs/pyscf/lib/python3.11/site-packages/scipy/linalg/_decomp.py", line 593, in eigh
    raise LinAlgError('The leading minor of order {} of B is not '
numpy.linalg.LinAlgError: The leading minor of order 2 of B is not positive definite. The factorization of B could not be completed and no eigenvalues or eigenvectors were computed.
