%%%%%%%%%%%%
%% Please rename this main.tex file and the output PDF to
%% [lastname_firstname_graduationyear]
%% before submission.
%%
%% This .tex file is for use with BibLaTeX. Please use
%% main-bibtex.tex instead if you prefer BibTeX.
%%%%%%%%%%%%

\documentclass[12pt]{caltech_thesis}
\usepackage[hyphens]{url}
\usepackage{lipsum}
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{todonotes}
\usepackage{physics}
\usepackage{booktabs}
\usepackage{tikz}
\usepackage{pgf}

%% Tentative: newtx for better-looking Times
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{newtxtext,newtxmath}
% Must use biblatex to produce the Published Contents and Contributions, per-chapter bibliography (if desired), etc.
\usepackage[
    backend=biber,natbib,
    % IMPORTANT: load a style suitable for your discipline
    style=nature
]{biblatex}
\usepackage{nomencl}


\makenomenclature
%% This code creates the groups
% -----------------------------------------
\usepackage{etoolbox}
\renewcommand\nomgroup[1]{%
  \item[\bfseries
  \ifstrequal{#1}{M}{Molecular orbital basis}{%
  \ifstrequal{#1}{N}{Number sets}{%
  \ifstrequal{#1}{O}{Other symbols}{}}}%
]}
% -----------------------------------------

\usepackage{listings} % Required for insertion of code
\usepackage{xcolor} % Required for custom colors

% Define custom colors
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

% Setup the style for code listings
\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},   
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2
}

% Activate the style
\lstset{style=mystyle}
\usepackage{hyperref}
\usepackage{multirow}

% Name of your .bib file(s)
\addbibresource{examples.bib}
\addbibresource{ownpubs.bib}

\begin{document}

% Do remember to remove the square bracket!
\title{$G_0W_0$ for Molecules}
\author{Patryk Kozlowski}

\degreeaward{Bachelor of Science in Chemistry}                 % Degree to be awarded
\university{California Institute of Technology}    % Institution name
\address{Pasadena, California}                     % Institution address
\unilogo{caltech.png}                                 % Institution logo
\copyyear{2024}  % Year (of graduation) on diploma
\defenddate{June 7th, 2024}          % Date of defense

\orcid{0009-0000-6402-4261}

%% IMPORTANT: Select ONE of the rights statement below.
\rightsstatement{All rights reserved}
% \rightsstatement{All rights reserved except where otherwise noted}
% \rightsstatement{Some rights reserved. This thesis is distributed under a [name license, e.g., ``Creative Commons Attribution-NonCommercial-ShareAlike License'']}

%%  If you'd like to remove the Caltech logo from your title page, simply remove the "[logo]" text from the maketitle command
\maketitle[logo]
%\maketitle

\begin{acknowledgements} 	 

   I am indebted to all the medical professionals who have made my return to academics possible. I could not have done this without the help of dictation software Talon with its related Slack community and, particularly, the guys at Cursorless, who have taught me to code by voice "at the speed of thought". I would like to thank my advisor, Professor Garnet Chan, for offering me a path to return to academics after my medical leave. Many thanks to Doctor Johannes Tolle, who has struck the balance of being a patient, yet demanding, mentor and has pushed me to become an improved electronic structural theorist. Last, but not least, I would like to thank my family and, particularly, my mom for being my biggest supporters in my rehabilitation and academic journey.
\end{acknowledgements}



%% Uncomment the `iknowhattodo' option to dismiss the instruction in the PDF.


\tableofcontents
\listoffigures
\listoftables
\printnomenclature

\mainmatter

\chapter{Nomenclature}
\label{chap:nomenclature}
\begin{tabular}{p{0.65\textwidth} p{0.8\textwidth}}
Symbol & Description \\
\hline
\(i,j,k,l\) & Occupied orbital indices \\
\(a,b,c,d\) & Virtual orbital indices \\
\(p,q,r,s\) & General MO indices \\
\(\mu,\nu,\lambda,\sigma\) & AO indices \\
\((pq|rs) = \int \int \psi_p^*(\mathbf{r}_1)\psi_q(\mathbf{r}_1)\frac{1}{r_{12}}\psi_r^*(\mathbf{r}_2)\psi_s(\mathbf{r}_2)d\mathbf{r}_1d\mathbf{r}_2\) & Two-electron spatial integrals\\
\((pq||rs) = (pq|rs) - (ps|rq)\) & Antisymmetrized two-electron integrals \\
\(\chi _p (\mathbf{x}) = \psi _p (\mathbf{r})\sigma (\mathbf{\omega })\) & Spin-orbital \\
\([pq|rs] = \int \int \chi_p^*(\mathbf{x}_1)\chi_q(\mathbf{x}_1)\frac{1}{r_{12}}\chi_r^*(\mathbf{x}_2)\chi_s(\mathbf{x}_2)d\mathbf{x}_1d\mathbf{x}_2\) & Two-electron spin integrals \\

\end{tabular}\\\\
All calculations have been done using the PySCF package.\autocite{sun_recent_2020} The code for this project can be found at \url{https://github.com/pkozlows/gw_senior_thesis/tree/master}.
\chapter{Motivation}
The formalism of many-body perturbation theory (MBPT) provides corrections to a mean-field description such as that given by Hartree-Fock or density functional theory (DFT). Hartree-Fock is not used much in practice because it is known to provide a weak treatment of electron correlation due to the fact that it only considers the average interaction between electrons and not the explicit one. DFT has a similar computational scaling to Hartree-Fock, but it can deliver accurate results for larger systems. \autocite{amusia_density_2003} However, it treats electron correlation in an approximate way that is difficult to systematically improve. Specifically, its reliance on approximate functionals gives rise to the notorious self-interaction error; this means that one can have the electron interacting with its own contribution to the electron density. In practice, this can potentially lead to a variety of issues, including the underestimation of surface stability (overestimation of surface energies) relevant in surface science studies. \autocite{schimka_accurate_2010} \autocite{kozlowski_elucidating_2021} To remedy the problems with the mean field approximations, normally one would fall back onto the wave function-based MBPT, such as Moller-Plesset perturbation theory to 2nd order (MP2) and coupled cluster theory (CC). However, their computational scaling is steep, scaling like $O(N^5)$ and $O(N^6)$ or greater, respectively, which can make it difficult to simulate larger systems. \autocite{mcclain_gaussian-based_2017} To bridge the gap between the cheap mean-field methods and the expensive wave function-based MBPT, there has been an interest in applying Green's function MBPT methods, within the $GW$ approximation, to such systems, which has shown to give accurate corrections to various properties, such as band gaps, on top of a prior (DFT) mean-field calculation, at a moderate computational cost. \autocite{noauthor_frontiers_nodate} This is the motivation for my study of the $GW$ approximation within its one-shot variant $G_0W_0$, which practically scales like $O(N^4)$.



\chapter{Theory}
We begin by writing out the time independent electronic Schr√∂dinger equation for the $N$-electron system
\begin{equation}
    \hat{H}\Psi_0 =E_0\Psi_0 
\label{eqn:tise}
\end{equation}
with
\begin{equation}
\hat{H}=\sum_{i=1}^N\left(-\frac{1}{2} \nabla_i^2\right)-\sum_{i=1}^N \sum_{\alpha }\frac{Z_{\alpha }}{r_{i\alpha }}+\sum_{i<j}^N \frac{1}{r_{i j}} + C_{nn}.
\label{eqn:hamiltonian}
\end{equation}
In equation \ref{eqn:tise}, $\hat{H}$ is the Hamiltonian operator, while $\Psi_0$ and $E_0$ are the ground state wave function and energy of the system, respectively. As shown in equation \ref{eqn:hamiltonian}, the Hamiltonian operator consists of four terms: a kinetic term, in which a sum of the kinetic operators $-\frac{1}{2} \nabla_i^2$ of each electron is taken; a nuclear-electron attraction term, in which we have sums running over all of the electrons $i$ and all of the nuclei $\alpha$ with their separation denoted by $r_{i\alpha}$ and the nuclear charge denoted by $Z_{\alpha}$; an electron-electron repulsion term, in which we have a sum running over all pairs of electrons $i$ and $j$ with their separation denoted by $r_{ij}$; and a nuclear-nuclear repulsion term $C_{nn}$, which we have denoted as a constant since we are working in the Born-Oppenheimer approximation of all electrons moving in a fixed nuclear framework.
The objective of many years of research in quantum chemistry has been to solve equation \ref{eqn:tise} with the complication arising from accurately describing the electron-electron repulsion, whose operator we will call $\hat{V}_{ee}$.
Now, I will introduce some of the mean field methods that have been classically used to tackle this problem at a cheap computational cost.
\section{Mean Field Methods}
\subsection{Hartree-Fock\autocite{szabo_modern_2012}}
\label{sec:hf}
The concept behind Hartree-Fock (HF) is that we can assign each electron a given orbital $\chi_{i} (\mathbf{r}_{i}, \sigma_{i})$, where $\mathbf{r}_{i}$ is the spatial coordinate and $\sigma_{i}$ is the spin of the $i$th electron. We then construct the many-electron wave function as a Hartree product of these orbitals
\begin{equation}
    \Phi _{\mathrm{Hartree}} = \chi _1(\mathbf{r}_1, \sigma_1) \chi _2(\mathbf{r}_2, \sigma_2) \cdots \chi _N(\mathbf{r}_N, \sigma_N).
\end{equation}
However, this is not antisymmetric with respect to the exchange of two electrons, so we need to enforce antisymmetry by taking a Slater determinant of these orbitals
\begin{equation}
    \Psi _{\mathrm{HF}} = \frac{1}{\sqrt{N!}} \begin{vmatrix}
    \chi _1(\mathbf{r}_1, \sigma_1) & \chi _2(\mathbf{r}_1, \sigma_1) & \cdots & \chi _N(\mathbf{r}_1, \sigma_1) \\
    \chi _1(\mathbf{r}_2, \sigma_2) & \chi _2(\mathbf{r}_2, \sigma_2) & \cdots & \chi _N(\mathbf{r}_2, \sigma_2) \\
    \vdots & \vdots & \ddots & \vdots \\
    \chi _1(\mathbf{r}_N, \sigma_N) & \chi _2(\mathbf{r}_N, \sigma_N) & \cdots & \chi _N(\mathbf{r}_N, \sigma_N) 
    \end{vmatrix}.
\end{equation}
So we have arrived at the Hartree-Fock energy, which is defined as
\begin{equation}
    E_{\mathrm{HF}} = \langle \Psi _{\mathrm{HF}} | \hat{H} | \Psi _{\mathrm{HF}} \rangle,
\end{equation}
where we have assumed the normalization $\langle \Psi _{\mathrm{HF}} | \Psi _{\mathrm{HF}} \rangle = 1$.
Now we seek to minimize this energy with respect to the constituent orbitals. This may be done by defining the Lagrangian
\begin{equation}
    \mathcal{L} = E_{\mathrm{HF}} - \lambda \left( \langle \Psi _{\mathrm{HF}} | \Psi _{\mathrm{HF}} \rangle - 1 \right),
\end{equation}
where $\lambda$ is a Lagrange multiplier that enforces the normalization condition. We then take the functional derivative of the Lagrangian with respect to the orbitals and set it to zero to find the minimum of the energy
\begin{equation}
    \frac{\delta \mathcal{L}}{\delta \chi _i} = 0.
\end{equation}
Carrying out this minimization leads to the eigenvalue equation known as the Hartree-Fock equations
\begin{equation}
    \hat{F}\chi _i = \epsilon _i \chi _i,
\end{equation}
where $\hat{F}$ is the Fock operator, which is defined as
\begin{equation}
    \hat{F} = \hat{h} + \hat{V}_{HF},
\end{equation}
with $\hat{h}$ being the one-electron part of the Hamiltonian and $\hat{V}_{HF}$ being the Hartree-Fock potential. It should be noted that $\hat{h}$ corresponds to the first and second terms, whereas $\hat{V}_{HF}$ corresponds to the third term, respectively, of equation \ref{eqn:hamiltonian}. The Hartree-Fock potential is defined as
\begin{equation}
    \hat{V}_{HF} = \sum_{j=1}^{N} \left( \hat{J}_j - \hat{K}_j \right),
\label{eqn:vhf}
\end{equation}
where $N$ is the number of electrons in the system, $\hat{J}_j$ is the local Coulomb operator
\begin{equation}
    \bra{\chi_i(\mathbf{r}_1)} \hat{J}_j(\mathbf{r}_1) \ket{\chi_i(\mathbf{r}_1)} = \int \int d\mathbf{r}_1 d\mathbf{r}_2 \frac{\chi_i^*(\mathbf{r}_1) \chi_i(\mathbf{r}_1) \chi_j^*(\mathbf{r}_2) \chi_j(\mathbf{r}_2)}{r_{12}}=[ii|jj],
\end{equation}
 and $\hat{K}_j$ is the nonlocal exchange operator
\begin{equation}
    \bra{\chi_i(\mathbf{r}_1)} \hat{K}_j(\mathbf{r}_1) \ket{\chi_i(\mathbf{r}_1)} = \int \int d\mathbf{r}_1 d\mathbf{r}_2 \frac{\chi_i^*(\mathbf{r}_1) \chi_j(\mathbf{r}_1) \chi_j^*(\mathbf{r}_2) \chi_i(\mathbf{r}_2)}{r_{12}}=[ij|ji].
\end{equation}
We have used the notation for the spin integrals as given in Chapter \ref{chap:nomenclature}. So when we consider equation \ref{eqn:vhf}, now performing an additional sum over the spins orbitals being operated on (defined previously, for the general case, as $i$) in order to treat all unique pairs of occupied spin orbitals, we arrive at the $\hat{V}_{ee}$


\begin{equation}
    \hat{V}_{ee} = \frac{1}{2} \sum_{{i}}^{\text{occ}} \sum_{{j}}^{\text{occ}} \left( [{i}{i}|{j}{j}] - [{i}{j}|{j}{i}] \right).
\end{equation}
 We simplify by performing a spin integration to convert to spatial integrals, as defined in Chapter \ref{chap:nomenclature}
\begin{equation}
    \hat{V}_{ee} = \frac{1}{2} \sum_{{i}}^{\text{occ}} \sum_{{j}}^{\text{occ}} \sum_{\sigma = \alpha, \beta} \left( (i_{\sigma }i_{\sigma }|j_{\sigma }j_{\sigma }) - (i_{\sigma }j_{\sigma }|j_{\sigma }i_{\sigma }) \right) = \sum_i^{\text {occ }} \sum_j^{\text {occ }} 2(ii|jj) - (ij|ji).
\end{equation}
Notice that the Coulomb term will obtain a factor of 2 after the spin integration, whereas the exchange term will only survive if the spins for $i$ and $j$ are the same. So Hartree-Fock fails to correlate electrons of opposite spin. In this work, we will work in the spin restricted Hartree-Fock formalism, which considers a single electronic orbital to be doubly occupied, with the two electrons having the same spatial part, but different spin parts.
\subsection{Density Functional Theory (DFT)}
The central quantity in DFT is the electron density $\rho_\textbf{r} $. The motivation for DFT can be seen by considering that the wave function depends on the whereabouts of $N$ electrons, each defined by their own orbital in the Hartree-Fock theory, which in turn each have 3 directions within spatial coordinate $\textbf{r}$. The electron density, on the other hand, is a function of just 3 variables, $x$, $y$, and $z$. Hohenberg and Kohn were able to take advantage of this fact when they proved that the ground state energy of a system is a unique functional of the electron density \autocite{Hohenberg1964}
\begin{equation}
    E[\rho_\textbf{r} ] = T[\rho_\textbf{r} ] + V_{ne}[\rho_\textbf{r} ] + V_H[\rho_\textbf{r} ] + V_{xc}[\rho_\textbf{r} ] + V_{nn},
\end{equation}
where $T$ and $V_{ne}$ are from the kinetic and nuclear-electron attraction of the first and second terms of equation \ref{eqn:hamiltonian}, respectively. $V_H$ is the Hartree potential, which is just an alternate name for the Coulomb term of section \ref{sec:hf}, and $V_{xc}$ is the exchange-correlation potential. These two terms are designed to give a more accurate treatment of the electron electron repulsion than Hartree-Fock, with the $V_{xc}$ taking into account correlation effects.
 In practise, the $V_{xc}$ is approximated, but many levels of designing it have been made, as described by Jacob's Ladder. \autocite{milman_jacobs_2021} Finally, $V_{nn}$ is the nuclear-nuclear repulsion term. Kohn and Sham then define a self consistent procedure by which the electron density can be used to define a set of noninteracting orbitals, which is now known as Kohn-Sham DFT (KS-DFT).\autocite{PhysRev.140.A1133}
\\\\ What is important to understand is that both the HF and KS-DFT mean field methods yield a reasonable first guess \autocite{bruneval_gw_2021} at molecular orbitals $\chi$. We will later correct these orbitals with MBPT.
\section{Green's functions}
\subsection{Definitions}
One can define the single-particle Green's function $\mathcal{D}$ as
\begin{equation}
\mathcal{D}\left(\mathbf{r}_1, t_1 ; \mathbf{r}_2, t_2\right)=-i\left\langle N\left|\hat{T}\left[\hat{\psi }\left(\mathbf{r}_1, t_1\right) \hat{\psi }^{\dagger}\left(\mathbf{r}_2, t_2\right)\right]\right|  N\right\rangle,
\end{equation}
where $\hat{\psi }^{\dagger}$ ($\hat{\psi }$) are the field operators for creating (destroying) a particle at spacetime coordinates $\mathbf{r}_{i}$ and $t_{i}$, respectively. $\hat{T}$ is the time-ordering operator that ensures that the field operator at the earlier time is acting on the ket before the field operator at the later time, and $N$ is the $N$-electron ground state of the system. Now, we make a distinction between the noninteracting and interacting Green's functions, denoted as $G_0$ and $G$, respectively. The noninteracting case signifies that the particles in the system are not interacting with each other, with a Green's function given as
\begin{equation}
G_0\left(\mathbf{r}_1, t_1 ; \mathbf{r}_2, t_2\right)=-i\left\langle\Phi_0\left|\hat{T}\left[\hat{\psi }\left(\mathbf{r}_1, t_1\right) \hat{\psi }^{\dagger}\left(\mathbf{r}_2, t_2\right)\right]\right| \Phi_0\right\rangle,
\end{equation}
where now $\Phi_0$ is the ground state wave function composed of noninteracting orbitals as obtained by a mean field calculation. In contrast, the interacting Green's function is defined as
\begin{equation}
G\left(\mathbf{r}_1, t_1 ; \mathbf{r}_2, t_2\right)=-i\left\langle \Psi _0\left|\hat{T}\left[\hat{\psi }\left(\mathbf{r}_1, t_1\right) \hat{\psi }^{\dagger}\left(\mathbf{r}_2, t_2\right)\right]\right|  \Psi _0\right\rangle,
\end{equation}
where now $\Psi_0$ is the ground state wave function of a system where the particles can interact with each other.
 The Dyson equation relating these two quantities can be written symbolically as \autocite{bruneval_assessment_2019}
\begin{equation}
G=G_0+G_0\Sigma G \rightarrow \Sigma = G^{-1}-G_0^{-1},
\label{eqn:dyson}
\end{equation}
where $\Sigma$ is the self-energy. The self-energy is a quantity that accounts for the electron correlation that is not captured by the mean-field methods. An intuitive physical picture can be gained for the self-energy by considering the example of an electron shot into a gas of electrons, as shown in Figure \ref{fig:shot}.
\begin{figure}
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=.8\linewidth]{shot.png}
  \caption{The electron is shot into the gas}
  \label{fig:shot}
\end{subfigure}
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=.8\linewidth]{clothing.png}
  \caption{The electron creates holes as it moves along}
  \label{fig:clothing}
\end{subfigure}
\caption{Electron gas propagation taken from \textcite{mattuck_guide_1992}}
\label{fig:propagates}
\end{figure}
As the electron propagates through this medium, it will have an electrostatic repulsion with the electrons in the gas, so it will create holes (depicted in white) as it moves along (pictured in Figure \ref{fig:clothing}). Therefore, it no longer makes sense to think of the bare electron, but rather the quasi-electron along with its "clothing" of holes. To make this more rigorous, we have the equation
\begin{equation}
    \epsilon_{\text{quasi}} - \epsilon_{\text{bare}} = \epsilon_{\text{self}},
\end{equation}
which is saying that the difference between the quasi-electron energy and the bare electron energy can be thought of as the electron's self-energy, or just the energy of its "clothing". So we can think of $\epsilon_{\text{bare}}$ and $\epsilon_{\text{quasi}}$ as originating from the noninteracting and interacting Green's functions $G_0$ and $G$, respectively. The self-energy $\Sigma$ then captures the difference between these two quantities, as it is defined as the difference between their inverses, as shown in equation \ref{eqn:dyson}.
 Typically, $\Sigma $ is designed to capture all of the quantum mechanical effects of the many body system and practical realizations of it require computationally efficient approximations, which we will discuss in the next section.
\subsection{The $GW$ Approximation}
In order to solve the Dyson equation \ref{eqn:dyson}, we need to make approximations to the self-energy $\Sigma$. By introducing the screened Coulomb potential $W$, which represents the effective electrostatic interaction between electrons (as described above through the concept of the quasi-electron), the polarization function $P$, which describes the response of the system to the introduction of an electron, and the vertex function $\Gamma$, which describes the interaction between the electrons and holes, we can write down the five Hedin's equations \autocite{Hedin1965}
\begin{equation}
\begin{aligned}
& G(1,2)=G_0(1,2)+\int d(3,4) G_0(1,3) \Sigma(3,4) G(4,2) \\
& P(1,2)=\int d(3,4) G(1,3) G(4,1) \Gamma(3,4 ; 2) \\
& W(1,2)=V(1,2)+\int d(3,4) V(1,3) P(3,4) W(4,2) \\
& \Sigma(1,2)=\int d(3,4) G(1,3) \Gamma(3,2 ; 4) W(4,1) \\
& \Gamma(1,2 ; 3)=\delta(1,2) \delta(1,3)+\int d(4,5,6,7) \frac{\delta \Sigma(1,2)}{\delta G(4,5)} G(4,6) G(7,5) \Gamma(6,7 ; 3),
\end{aligned}
\end{equation}
where we have made use of the shorthand notation $1=(\mathbf{r}_1, t_1)$ and $V$ is the bare Coulomb potential. The $GW$ approximation is a simplification of these equations, where we neglect the vertex function $\Gamma$ by setting $\Gamma (1,2,3)= \delta (1,2) \delta (1,3)$. This simplifies the equations for the self-energy and polarization function to
\begin{equation}
\begin{aligned}
& \Sigma(1,2)=\int d(1,2) G(1,2) W(1,2) \\
& P(1,2)=\int d(1,2) G(1,2) G(2,1). \\
\end{aligned}
\end{equation}
\begin{figure}
    \centering
    \includegraphics[width=\textwidth]{Left-panel-Graphical-representation-of-Hedins-equations-Right-panel-The-four-coupled.jpg}
    \caption{Graphical representation of Hedin's equations taken from \textcite{noauthor_frontiers_nodate}. The left panel shows the full set of equations, whereas the right panel shows the $GW$ approximation.}
    \label{fig:hedin}
\end{figure}
The figure \ref{fig:hedin} shows the self-consistency between these equations, with the polarization $P$ represented by $\tilde{\chi}$. Full self-consistency, including the vertex function $\Gamma$, is shown in the left panel, whereas the $GW$ approximation, which neglects the vertex function, is shown in the right panel. The $G_0W_0$ method, which is studied in this work, only performs one loop of the $GW$ approximation cycle. This is why it is often termed a "one-shot" procedure.
\subsection{Application in MBPT}
Now that we have the recipe to solve for the interacting single-particle Green's function $G$, we can use it to obtain a perturbative correction to a variety of properties.  In this work, we use it to obtain quasiparticle orbitals $\chi^{QP}$, as an update to the mean-field orbitals $\chi^{MF}$. We also use it to incorporate correlation affects into the electron density via the linearized $G_0W_0$ density matrix derived in chapter \ref{chap:linearized_gw}. Finally, we use it to determine the total energy of the molecule with different total energy functionals in chapter \ref{chap:total_energy}. It can also be used, among other things, to compute the spectral function, which gives access to ionization potentials and electron affinities. \autocite{noauthor_frontiers_nodate}






\chapter{$G_0W_0$ Procedure}
\section{Iterative equation}
The linearized procedure that was used in this work to compute quasiparticle energies, is given by \autocite{bruneval_assessment_2019}
\begin{equation}
    \delta_{pq}F_{pq}^{\mathrm{HF}}[\gamma^{MF}] + \Sigma_{pp}^{\mathrm{Corr}}(\varepsilon_{p}^{\mathrm{QP}}) = \varepsilon_{p}^{\mathrm{QP}}.
\label{eq: Iterative equation}
\end{equation}
The first term corresponds to taking the diagonal of the matrix defined by the Hartree-Fock Fock operator, as defined in section \ref{sec:hf}, evaluated at the mean-field density $\gamma^{MF}$.
  The second term determines the correlation self energy dynamically by evaluating $\Sigma^{\mathrm{Corr}}$
for the $\varepsilon_{p}^{\mathrm{QP}}$ determined in the previous iteration; the common approximation of just considering the diagonal $\Sigma_{pp}^{\mathrm{Corr}}$ is used.
The right side of the equality gives the updated $\varepsilon_{p}^{\mathrm{QP}}$. So, we start by inputting the initial guess for $\varepsilon_{p}^{\mathrm{QP}}$, which is given by the mean-field orbital energy $\epsilon_p$, into $\Sigma_{pp}^{\mathrm{Corr}}(\varepsilon_{p}^{\mathrm{QP}})$, and iterate until self-consistency is reached.




\section{Correlation Self-Energy}
\label{sec:correlation_self_energy}
\begin{equation}
    \Sigma_{pp}^{\text{corr}}(\omega) = \sum_{\mu }^{\text{RPA}}\left(\sum_{i}^{\text{occupied}} \frac{V_{pi}^{\mu }V_{ip}^{\mu }}{\omega -(\epsilon _{i}-\Omega  _{\mu })}+ \sum_{a}^{\text{virtual}} \frac{V_{pa}^{\mu }V_{ap}^{\mu }}{\omega -(\epsilon _{a}+\Omega  _{\mu })}\right)
\end{equation}
This is the working equation for the correlation self-energy for a given molecular orbital (MO) $p$. First, we have a sum running over all of the excitations $\mu$ obtained from the previous RPA calculation, which will be introduced shortly. Then, we have two terms: one sum running over all of the occupied orbitals and the other sum running over all virtual orbitals. The $\Omega _{\mu }$ are the excitation energies, and the $V_{pq}^{\mu }$ defined the coupling between the excitation vectors and electron repulsion integrals, as defined within section \ref{subsection:coupling}. The $\epsilon _{i}$ and $\epsilon _{a}$ are the orbital energies of the occupied and virtual orbitals, respectively. The $\omega$ is the frequency at which we are evaluating the self-energy, which is the quasiparticle energy $\varepsilon_{p}^{\text{QP}}$ in the iterative equation \ref{eq: Iterative equation}.



\section{Random Phase Approximation}
The RPA is a linear response theory that is used to compute the excitation energies and vectors. The working matrix equation is given by \autocite{dreuw_single-reference_2005}
\begin{equation}
\begin{bmatrix}
\textbf{A} & \textbf{B} \\
-\textbf{B} & -\textbf{A}
\end{bmatrix}
\begin{bmatrix}
\textbf{X} \\
\textbf{Y}
\end{bmatrix}
=
\begin{bmatrix}
\textbf{X} \\
\textbf{Y}
\end{bmatrix}
\boldsymbol{\Omega }
,
\label{eq: RPA matrix equation}
\end{equation}
where we define $\boldsymbol{\Omega}$ as a diagonal matrix containing the excitation and de-excitation energies, which have the same magnitude $\Omega^{|\mu|}$. Accordingly, we just use the excitation energies in what follows which we simply denote as $\Omega _{\mu }$. The matrix
$\textbf{A}$ is defined as
\begin{equation}
    A_{ia,jb} = \delta _{ij}\delta _{ab}(\epsilon _{a}- \epsilon _{i}) + 2(ia||jb)
\label{eq: A matrix RPA}
\end{equation}
and $\textbf{B}$ is
\begin{equation}
    B_{ia,jb} = 2(ia||jb)
\label{eq: B matrix RPA}
\end{equation}
where the anti-symmetrized two-electron integrals are defined in Chapter \ref{chap:nomenclature}.

$\textbf{X}$ and $\textbf{Y}$ correspond to excitations and the de-excitations, respectively.
\subsection{Direct approximation}
Everywhere in this work, we consider the direct approximation, which just means that all instances of anti-symmetrized two-electron integrals are replaced by their direct counterparts, i.e., in Equation \ref{eq: A matrix RPA}, and Equation \ref{eq: B matrix RPA}, $(ia||jb) \rightarrow (ia|jb)$.

An alternative formulation that takes advantage of the symmetry obtained through neglect of the de-excitation energies will be used in what follows in order to make solving the direct RPA eigenvalue problem, which is the bottleneck of the $GW$ calculation, more tractable and is derived in Appendix \ref{app:symm_drpa} as suggested by \textcite{furche_density_2001}.
\subsection{Excitation vectors with coupling}
\label{subsection:coupling}

The coupled excitation vectors $V _{pq}^{\mu }$ are defined 
 by considering a contraction of two tensors. First, we consider the sum of the excitation vectors $\textbf{X}$ and $\textbf{Y}$ at the same excitation energy $\mu$: $Z_{i,a}^{\mu} = X_{i,a}^{\mu} + Y_{i,a}^{\mu}$. Then, we define the appropriate integrals for contraction with this excitation
\begin{equation}
    W_{p,q,i,a} = \sqrt{2} \sum_{p,q,i,a} (pq|ia).
\end{equation}
This factor of $\sqrt{2}$ comes from the spin integration of the restricted formalism.
We define a combined occupied-virtual index $\nu$, so: ${Z}_{i,a}^{\mu} = {Z}_{\nu}^{\mu}$ and ${W}_{p,q,i,a} = {W}_{p,q,\nu}$.

And then we form the coupled excitation vectors from
\begin{equation}
    {V}_{pq}^{\mu} = \sum_{\nu} {W}_{p,q,\nu} {Z}_{\nu}^{\mu}.
\end{equation}

\subsection{Tamm-Dancoff Approximation}
In this method, we neglect the $\textbf{B}$ matrix of the RPA equation, so we are not considering the de-excitations of full RPA. So the eigenvalue equation becomes
\begin{equation}
    \textbf{A}\textbf{X} = \textbf{X} \boldsymbol{\Omega }
\end{equation}
where we still have:
\begin{equation}
    A_{ia,jb} = \delta _{ij}\delta _{ab}(\epsilon_{a}- \epsilon_{i}) + 2(ia||jb)
\label{eq: A matrix TDA}
\end{equation}
And then we follow the same procedure as in the RPA to get the residues $V_{pq}^{\mu}$, where now we have ${Z}_{\nu, \mu} = {X}_{\nu, \mu}$.

\chapter{Linearized $G_0W_0$ Density Matrix}
As noted earlier, we can get a new density matrix out of the interacting Green's function. Then this allows us to obtain new MOs through a rotation of those from the noninteracting Green's function. The form of this density matrix is shown below, and the derivation of it is given in Appendix \ref{applinearized_gw}.
\label{chap:linearized_gw}
\subsection{Implementation}
First, we consider the fully occupied block
\begin{equation}
\gamma_{ij}^{GW}=2\delta_{ij}-2\sum_{a\mu} \frac{{V}_{ia}^\mu {V}_{ja}^\mu}{\left(\epsilon_{i}-\epsilon_{a}-{\Omega ^{\mu}}\right)\left(\epsilon_{j}-\epsilon_{a}-{\Omega ^{\mu}}\right)},
\end{equation}
where the ${\Omega ^{\mu}}$ are the excitation energies and the ${V}_{pq}^{\mu}$ are the transition vectors. The sum runs over all virtual orbitals and excitation energies. Next, we have the virtual-virtual block
\begin{equation}
\gamma_{ab}^{GW}=-2\sum_{i\mu} \frac{{V}_{ai}^{\mu} {V}_{bi}^{\mu}}{\left(\epsilon_{i}-\epsilon_{a}-{\Omega ^{\mu}}\right)\left(\epsilon_{i}-\epsilon_{b}-{\Omega ^{\mu}}\right)},
\end{equation}
where the sum runs over all occupied orbitals and excitation energies.
Finally, we have the mixed block
\begin{equation}
    \gamma_{i b}^{G W}=\frac{2}{\epsilon_{i}-\epsilon_{b}}\left[ \sum_{a \mu} \frac{{V}_{i a}^{\mu} {V}_{b a}^{\mu}}{\epsilon_{i}-\epsilon_{a}-{\Omega ^{\mu}}} - \sum_{j \mu} \frac{{V}_{i j}^{\mu} {V}_{bj}^{\mu}}{\epsilon_{j}-\epsilon_{b}-{\Omega ^{\mu}}} \right],
\end{equation}
where we have two sums; one over occupied orbitals and excitation energies and the other over virtual orbitals and excitation energies.
This all contributes to the form of the density matrix as
\begin{equation*}
    2\begin{pmatrix}
        \gamma _{i j}^{G W} & \gamma _{i b}^{G W} \\
        \gamma _{bi}^{G W } & \gamma _{a b}^{G W}
    \end{pmatrix},
\end{equation*}
where $\gamma _{bi}^{G W }$ is simply the transpose of $\gamma _{ib}^{\text{GW}}$, since all elements of this matrix are real. Therefore, this density matrix is Hermitian. The factor of 2 comes from the spin integration of the restricted formalism.



\chapter{Results}
\subsection{Graphical vs. Iterative}
Equation \ref{eq: Iterative equation} can be solved iteratively, but also graphically in the HF case by plotting $\Sigma _{c}$ as a function of the input frequency, which takes on  the possible values for $\varepsilon_{p}^{QP}$. Since $F_{pq}^{HF}$ is diagonal in the canonical HF MO basis, Equation \ref{eq: Iterative equation} can be reformulated as
\begin{equation}
    \epsilon _{p}^{HF} + \Sigma_{pp}^{corr}(\omega) = \omega  \rightarrow \Sigma_{pp}^{corr}(\omega) = \omega  - \epsilon _{p}^{HF}.
\end{equation}
As can be seen in figure \ref{fig:graphic}, the line at $\omega - \epsilon_{p}^{HF}$ intersects with $\Sigma _{c}$ at the same $\varepsilon_{p}^{QP}$ that we get from our iterative procedure, namely at $\omega = -12.18 \, \mathrm{eV}$.
 This is a useful check to see if the self-energy, which we defined in section \ref{sec:correlation_self_energy}, has been computed correctly.
\begin{figure}[h]
    \centering
    \includegraphics[width=\textwidth]{correlation_energies.png}
\caption{Graphical solution of the correlation self-energy for the HOMO of $\mathrm{H_2O}$ employing a HF starting point with the cc-pVDZ basis}
\label{fig:graphic}
\end{figure}
Also, at around $\omega$ = -40 eV, one can observe a pole structure. This would pose problems for the convergence of my iterative procedure Equation \ref{eq: Iterative equation} if the $\varepsilon_{p}^{QP}$ that I was looking for was close to this $\omega $ value. \autocite{veril2018unphysical}
\newpage
\subsection{Testing of equation \ref{eq: Iterative equation}}
The correctness of my implementation has been verified for some molecules and molecular orbitals by comparing the results with the data from PySCF in Table \ref{tab:energies}.
\begin{table}[h]
\centering
\caption{Deviation in quasi-particle energies for four molecules using the $G_0W_0$ self-energy either evaluated within the dTDA or dRPA relative to PySCF (all values converted to $\mathrm{eV}$)}
\label{tab:energies}
\resizebox{\textwidth}{!}{%
\begin{tabular}{|c|c|c|c|c|c|c|c|c|}
\hline
\multirow{2}{*}{Orbital} & \multicolumn{2}{c|}{$H_2O$} & \multicolumn{2}{c|}{$NH_3$} & \multicolumn{2}{c|}{$LiH$} & \multicolumn{2}{c|}{$CO$} \\
\cline{2-9}
                         & dTDA & dRPA & dTDA & dRPA & dTDA & dRPA & dTDA & dRPA \\
\hline
HOMO - 2 & 1.78e-15 & 5.33e-15 & 5.33e-15 & 1.42e-14 & 4.21e-10 & 3.55e-14 & 1.73e-10 & 0.00477 \\
\hline
HOMO - 1 & 2.31e-14 & 1.07e-13 & 3.55e-15 & 2.33e-10 & 4.55e-12 & 2.84e-14 & 1.73e-10 & 0.00476 \\
\hline
HOMO     & 4.44e-15 & 2.84e-13 & 1.67e-11 & 1.30e-12 & 1.33e-15 & 1.96e-10 & 1.06e-12 & 2.84e-13 \\
\hline
LUMO     & 3.43e-14 & 2.65e-14 & 8.60e-14 & 8.78e-14 & 1.11e-15 & 2.66e-15 & 2.22e-15 & 0.00679 \\
\hline
LUMO + 1 & 2.14e-13 & 2.71e-14 & 4.40e-13 & 8.78e-14 & 1.12e-12 & 2.43e-14 & 3.11e-15 & 0.00678 \\
\hline
LUMO + 2 & 4.07e-11 & 6.92e-10 & 3.15e-14 & 4.97e-14 & 1.12e-12 & 3.09e-14 & 3.99e-14 & 3.99e-14 \\
\hline
\end{tabular}
}
\end{table}


The cc-pVDZ basis set was used for all calculations. As can be seen, deviations in the QP energies of my $G_0W_0$ implementation with respect to the corresponding in PySCF are near floating point error with the exception of my dRPA calculation for $\mathrm{CO}$, which has an electronic structure that is known to be difficult to describe because of unusual polarization with the dipole moment pointing towards the carbon, instead of the oxygen, as would be expected from electronegativity arguments. \autocite{frenking2007electronic}
\subsection{Total energy functionals}
\label{chap:total_energy}
The linearized $G_0W_0$ density matrix also gives access to energies through energy functionals that can be defined using it. We first tested our implementation against that of \textcite{bruneval_improved_2021} and specifically the correlation energies predicted by the Galitskii-Migdal functional of the noninteracting system with a Hartree-Fock starting point, which are given by the convolution of the correlation self-energy with the Green's function, as
\begin{equation}
E_{\mathrm{corr}}^{\mathrm{GM}}=-\frac{\mathrm{i}}{2} \int_{-\infty}^{\infty} \frac{\mathrm{d} \omega}{2 \pi} \int \mathrm{d} \boldsymbol{x}_1 \boldsymbol{x}_3 e^{\mathrm{i} \omega \eta} \Sigma_{\mathrm{c}}\left(\boldsymbol{x}_1 \boldsymbol{x}_3 ; \omega\right) \mathcal{D}\left(\boldsymbol{x}_3 \boldsymbol{x}_1 ; \omega\right),
\end{equation}
where $\Sigma_{\mathrm{c}}$ is the correlation self-energy, $\mathcal{D}$ is the Green's function, $\omega$ is the frequency, and $\eta$ is a small positive number. A Fourier transform has been taken to change the time dependence of the Green's function and self-energy to a frequency dependence. The integration variables $\boldsymbol{x}_1$ and $\boldsymbol{x}_3$ are the combined spatial and spin coordinates.
This can be simplified to
\begin{equation}
E_{\mathrm{corr}}^{\mathrm{GM}}=-2\sum_{\mu}^{\mathrm{RPA}} \sum_{i a} \frac{(V_{ia}^{\mu})^2}{\epsilon_a-\epsilon_i+\Omega_m}.
\label{eq:GM}
\end{equation}
There was a good agreement between my implementation of equation \ref{eq:GM} and that from the quantum chemistry codes MOLGW and FHI-AIMS \autocite{bruneval_improved_2021}, as shown by the small deviations in Table \ref{tab:galitskii}.\\\\
\begin{table}[h!]
    \centering
    \caption{Galitskii-Migdal correlation energies (as defined in \ref{eq:GM}; deviations are calculated with the difference between my implementation and the average of those from MOLGW and FHI-AIMS.}
    \begin{tabular}{lcccc}
        \toprule
        & \textbf{MOLGW} & \textbf{FHI-AIMS} & \textbf{Mine from eqn. \ref{eq:GM}} & \textbf{Deviation} \\
        \midrule
        \textbf{He} & -0.759780 & -0.759737 & -0.759781 & -0.000043 \\
        \textbf{Ne} & -0.120554 & -0.120551 & -0.120553 & -0.000002 \\
        \bottomrule
    \end{tabular}
    \label{tab:galitskii}
\end{table}
\newpage
\textcite{bruneval_improved_2021} proposed a new total energy functional using the linearized $G_0W_0$ density matrix, which uses the Galitskii-Migdal correlation functional
\begin{equation}
    E_{\text{tot}}^{\gamma ^{\mathrm{GW}}} = T_s [\gamma ^{\mathrm{GW}}] + V_H [\gamma ^{\mathrm{GW}} ] + V_x [\gamma ^{\mathrm{GW}} ] + V_{\text{nuc, elec}} [\gamma ^{\mathrm{GW}} ] + V_{\text{nuc, nuc}} + E_{\text{corr}} ^{\text{GM}}[\gamma_0],
\label{eq:GM_total_energy}
\end{equation}
where $T_s$ is the kinetic energy, $V_H$ the Hartree potential energy, $V_x$ is the exchange potential energy, $V_{\text{nuc, elec}}$ is the nuclear-electron potential energy, $V_{\text{nuc, nuc}}$ is the nuclear-nuclear potential energy, and $E_{\text{corr}} ^{\text{GM}}$ is the correlation energy, as defined in equation \ref{eq:GM}. Note that the linearized $G_0W_0$ density matrix $\gamma ^{\mathrm{GW}}$ is a correlated density matrix, meaning that it has fractional occupations and, therefore, we must evaluate the $E_{\text{corr}} ^{\text{GM}}$ with $\gamma_0$, as the RPA calculation needed to formulate equation \ref{eq:GM} is nonsensical with fractional excitations. Values obtained using this functional are given in Table \ref{tab:total_energy_gm}. As can be seen, the $\gamma ^{GW}$ results come very close to the CCSD(T) gold standard of the field \autocite{dykstra2011theory}, albeit at a much lower computational scaling (other implementations of $G_0W_0$ has been reduced to lower than $O(N^4)$ \autocite{forster2020low}) as opposed to the $O(N^7)$ scaling of CCSD(T). \autocite{szabo2023linear}
\begin{table}[h!]
    \centering
    \caption{Total energies (in Hartrees) from a non interacting Hartree-Fock system, the linearized $G_0W_0$ density matrix, with the energy functional defined in equation \ref{eq:GM_total_energy}, and the CCSD(T) reference.}
\begin{tabular}{lrrr}
\toprule
& \textbf{HF} & \textbf{$\gamma ^{\mathrm{GW}}$} & \textbf{CCSD(T)} \\
\midrule
\textbf{H$_2$O}& -75.973547 & -76.165785 & -76.191362 \\
\textbf{NH$_3$}& -56.172182 & -56.357917 & -56.377910 \\
\textbf{LiH}& -7.983642 & -8.016075 & -8.014747 \\
\bottomrule
\end{tabular}

\label{tab:total_energy_gm}
\end{table}
\\






\subsection{Plotting natural occupations}
The natural occupations are found by diagonalizing the density matrix. They are interpreted as being the number of electrons in a given orbital.\autocite{szabo_modern_2012}
\begin{figure}[h]
    \centering
    \includegraphics[width=\textwidth]{h2_occupations.png}
\caption{Natural occupations of the HOMO (State 1) and LUMO (State 2) of $\mathrm{H_2}$ along the dissociation coordinate computed at the Hartree-Fock starting point and the cc-pVDZ basis}
\label{fig:h2_dissociation}
\end{figure}
When $\mathrm{H_2}$ is at the equilibrium bond distance near equilibrium, we see in Figure \ref{fig:h2_dissociation} that the HOMO is fully occupied with 2 electrons, while the LUMO is unoccupied. This situation is represented by the simple MO diagram in Figure \ref{fig:h2_mo_diagram}. As the molecule dissociates, the orbital occupations for the restricted Hartree-Fock method do not change at all and so it predicts that the hydrogen molecule will become two ions, while the exact reference of FCI gives the expected result of the HOMO and LUMO natural orbitals both having occupations of 1 electron, characteristic of the hydrogen atom, as described by \textcite{bruneval_improved_2021}. The dRPA and dTDA are clearly capable of capturing some of the correct physics by changing the occupations along the dissociation coordinate towards that of two seperate hydrogen atoms, but fall short of the FCI reference.
\begin{figure}[h]
    \centering
    \includegraphics[width=\textwidth]{h2_mo.png}
\caption{MO diagram of $\mathrm{H_2}$ at the equilibrium bond distance. Note that this diagram is assuming a minimal basis set. Notice that the HOMO is fully occupied with 2 electrons, while the LUMO is unoccupied. Diagram taken from the web \autocite{noauthor_molecular_nodate}}
\label{fig:h2_mo_diagram}
\end{figure}
\chapter{Conclusion}
    To start with, we considered the foundational mean-field theories, like Hartree-Fock or DFT, from which we are able to carry out many-body perturbation theory calculations. Next, we introduced the formalism of Green's functions within the framework of MBPT, the concept of the self-energy, the $GW$ approximation, and the one-shot $G_0W_0$ method. We explained how to implement the $G_0W_0$ iterative procedure, including details for the construction of the self-energy from a RPA calculation. Then, we investigated properties of the recently proposed linearized $G_0W_0$ density matrix\autocite{bruneval_assessment_2019}. We then provided a verification of my implementation and some illuminating results of the linearized $G_0W_0$ density matrix, including how one can use it to access total energy functionals and improve natural occupations throughout a bond dissociation process, done for the first time here using the direct Tamm-Dancoff approximation (dTDA).
\chapter{Outlook}
The linearized $G_0W_0$ density matrix has only recently been proposed, and there are multiple avenues for using it in further work. One could imagine a scheme where
\begin{enumerate}
    \item we use a set of (mean field) orbitals to compute the self-energy,
    \item use this to construct the linearized $G_0W_0$ density matrix,
    \item compute a total energy functional,
    \item generate new QPs from the updated density matrix, and
    \item iterate 1-4 until self-consistency in the total energy.
\end{enumerate}
 An alternative formulation of Hedin's equations that gives rise to different forms for the self-energy, as described by the T-matrix, has been introduced by \textcite{Orlando_2023}. It would be interesting to derive a density matrix similar to the linearized $G_0W_0$ density matrix we have studied, but for this T-matrix self-energy.

\printbibliography[heading=bibintoc]

\appendix

\chapter{Symmetric formulation of the dRPA}
\label{app:symm_drpa}
Since we know that the excitation and de-excitation energies for the RPA are the same in magnitude, we can simplify the matrix equation to:
\begin{equation}
\begin{bmatrix}
\textbf{A} & \textbf{B} \\
-\textbf{B} & -\textbf{A}
\end{bmatrix}
\begin{bmatrix}
\textbf{X} \\
\textbf{Y}
\end{bmatrix}
= 
\begin{bmatrix}
\textbf{X} \\
\textbf{Y}
\end{bmatrix}
\boldsymbol{\Omega^{|\mu|} }
.
\end{equation}
In what follows, we will take $\boldsymbol{\Omega }$ to mean $\boldsymbol{\Omega^{|\mu|} }$.
The linearity suggests breaking down the problem into a set of linear equations
\begin{align}
    \textbf{AX} + \textbf{BY} &= \boldsymbol{\Omega } \textbf{X}\\
    -\textbf{BX}-\textbf{AY} &= \boldsymbol{\Omega } \textbf{Y},
\label{eqn:linearity}
\end{align}
which can be simplified by the addition of these two equations in \ref{eqn:linearity}
\begin{equation}
    (\textbf{A}-\textbf{B})(\textbf{X}-\textbf{Y})= \boldsymbol{\Omega } (\textbf{X}+\textbf{Y})
\label{eqn:for_addition}
\end{equation}
which can be rearranged to give
\begin{equation}
    (\textbf{X}+\textbf{Y}) = \boldsymbol{\Omega }^{-1}(\textbf{A}-\textbf{B})(\textbf{X}-\textbf{Y}).
\label{eqn:addition}
\end{equation}
Doing a pairwise subtraction of the equations in \ref{eqn:linearity} instead gives
\begin{equation}
    (\textbf{A}+\textbf{B})(\textbf{X}+\textbf{Y})= \boldsymbol{\Omega } (\textbf{X}-\textbf{Y}). 
\label{eqn:for_subtraction}
\end{equation}
Similarly, we can isolate
\begin{equation}
    (\textbf{X}-\textbf{Y}) = \boldsymbol{\Omega }^{-1}(\textbf{A}+\textbf{B})(\textbf{X}+\textbf{Y}).
\label{eqn:subtraction}
\end{equation}
Equations \ref{eqn:for_addition} and \ref{eqn:for_subtraction} can be combined to get
\begin{equation}
    \boldsymbol{\Omega } = (\textbf{X}-\textbf{Y})^{\dag} (\textbf{A}-\textbf{B})(\textbf{X}-\textbf{Y})
\end{equation}
and
\begin{equation}
    \boldsymbol{\Omega } = (\textbf{X}+\textbf{Y})^{\dag} (\textbf{A}+\textbf{B})(\textbf{X}+\textbf{Y}).
\end{equation}
Substituting in for $\textbf{X}+\textbf{Y}$ from \ref{eqn:addition} into equation \ref{eqn:for_subtraction}
\begin{equation}
    \boldsymbol{\Omega }^{-1}(\textbf{A}+\textbf{B})(\textbf{A}-\textbf{B})(\textbf{X}-\textbf{Y}) = \boldsymbol{\Omega } (\textbf{X}-\textbf{Y}).
\end{equation}
Multiplication by $\boldsymbol{\Omega }$ gives
\begin{equation}
    (\textbf{A}+\textbf{B})(\textbf{A}-\textbf{B})(\textbf{X}-\textbf{Y}) = \boldsymbol{\Omega }^2 (\textbf{X}-\textbf{Y}).
\end{equation}
Now, we plug the definition in equation \ref{eqn:subtraction} for the $(\textbf{X}-\textbf{Y})$ terms
\begin{equation}
    (\textbf{A}+\textbf{B})(\textbf{A}-\textbf{B})\boldsymbol{\Omega }^{-1}(\textbf{A}+\textbf{B})(\textbf{X}+\textbf{Y}) = \boldsymbol{\Omega }^2 \boldsymbol{\Omega }^{-1}(\textbf{A}+\textbf{B})(\textbf{X}+\textbf{Y}).
\end{equation}
Multiplication through by $\boldsymbol{\Omega }$ gives and $(\textbf{A}+\textbf{B})^{-1}$ gives
\begin{equation}
    (\textbf{A}-\textbf{B})(\textbf{A}+\textbf{B})(\textbf{X}+\textbf{Y}) = \boldsymbol{\Omega }^{2} (\textbf{X}+\textbf{Y}).
\end{equation}
At this point we want to define $\textbf{T}=(\textbf{A}-\textbf{B})^{-\frac{1}{2}}(\textbf{X}+\textbf{Y})$, so that we can write
\begin{equation}
    (\textbf{A}-\textbf{B})(\textbf{A}+\textbf{B})(\textbf{A}-\textbf{B})^{\frac{1}{2}}\textbf{T} = \boldsymbol{\Omega }^{2} (\textbf{A}-\textbf{B})^{\frac{1}{2}}\textbf{T}.
\end{equation}
Dividing through by $(\textbf{A}-\textbf{B})^{\frac{1}{2}}$ gives:
\begin{equation}
    (\textbf{A}-\textbf{B})^{\frac{1}{2}}(\textbf{A}+\textbf{B})(\textbf{A}-\textbf{B})^{\frac{1}{2}}\textbf{T} = \boldsymbol{\Omega }^{2} \textbf{T}.
\label{eqn:final}
\end{equation}
We can solve this matrix equation now. We can use this definition for $\textbf{T}$ to redefine equation \ref{eqn:addition} 
\begin{equation}
    (\textbf{X}+\textbf{Y}) = (\textbf{A}-\textbf{B})^{\frac{1}{2}}\textbf{T}.
\end{equation}
And then for normalization, we need
\begin{equation}
    (\textbf{X}-\textbf{Y})^{\dag}(\textbf{X}+\textbf{Y})=1.
\end{equation}
So we need
\begin{equation}
    (\textbf{X}-\textbf{Y})=(\textbf{A}-\textbf{B})^{-1}(\textbf{X}+\textbf{Y})\boldsymbol{\Omega } .
\end{equation}
So we can instead use the solution of equation \ref{eqn:final} to obtain the excitation energies $\boldsymbol{\Omega }$ and the excitation vectors $\textbf{X}$ and $\textbf{Y}$, the latter of which we will then use to construct our cou excitation vectors ${V}^{\mu}_{pq}$.














\chapter{Derivation of the linearized $G_0W_0$ density matrix}
This derivation will be carried out in the spin-unrestricted formalism, with the spin represented by $\sigma $.
\label{applinearized_gw}
We have the equation for the density matrix
\begin{equation}
\begin{aligned}
\gamma^\sigma\left(\mathbf{r}_1, \mathbf{r}_2\right)= & \gamma_0^\sigma\left(\mathbf{r}_1, \mathbf{r}_2\right) -\frac{\mathrm{i}}{2 \pi} \int \mathrm{d} \mathbf{r}_3 \mathrm{~d} \mathbf{r}_4 \mathrm{~d} \omega \mathrm{e}^{\mathrm{i \omega \eta}} G_0^\sigma\left(\mathbf{r}_1, \mathbf{r}_3, \omega\right) \Sigma_c^\sigma\left(\mathbf{r}_3, \mathbf{r}_4, \omega\right) G_0^\sigma\left(\mathbf{r}_4, \mathbf{r}_2, \omega\right)
\label{eqninit_dm}
\end{aligned}
\end{equation}
where $\gamma^\sigma$ is our new density matrix from the interacting Green's function, and $\gamma_0^\sigma$ is the density matrix from the noninteracting Green's function. $\omega$ is the frequency and $\eta$ is a small infinitesimal positive number, which we will later take to be zero. $G_0^\sigma(\omega)$ and $\Sigma_c^\sigma(\omega)$ are the noninteracting Green's function and the correlation self-energy, respectively, now Fourier transformed to the frequency domain.
In order to simplify the integral, let us consider
\begin{equation}
I = \int \mathrm{d} \mathbf{r}_3 \mathrm{~d} \mathbf{r}_4  G_0^\sigma\left(\mathbf{r}_1, \mathbf{r}_3\right) \Sigma_c^\sigma\left(\mathbf{r}_3, \mathbf{r}_4\right) G_0^\sigma\left(\mathbf{r}_4, \mathbf{r}_2\right)
\end{equation}
The noninteracting Green's function in the MO basis is defined as
\begin{equation}
G_0\left(\mathbf{r}_1, \mathbf{r}_2, \right) = \sum_{pq} \phi_p^*(\mathbf{r}_1) G_{p q} \phi_q(\mathbf{r}_2)
\end{equation}
and likewise for the self-energy
\begin{equation}
\Sigma_c\left(\mathbf{r}_1, \mathbf{r}_2, \right) = \sum_{pq} \phi_p^*(\mathbf{r}_1) \Sigma_{c pq} \phi_q(\mathbf{r}_2)
\end{equation}
where $G_{p q}$ and $\Sigma_{p q}$ are the matrix elements of the noninteracting Green's function and the self-energy, respectively. We can rewrite the integral as
\begin{equation}
I_1 = \sum_{pq} \sum_{rs} \sum_{tu} \int \mathrm{d} \mathbf{r}_3 \mathrm{~d} \mathbf{r}_4 \phi_p^*(\mathbf{r}_1) G_{p q} \phi_q(\mathbf{r}_3) \phi_r^*(\mathbf{r}_3) \Sigma_{r s} \phi_s(\mathbf{r}_4) \phi_t^*(\mathbf{r}_4) G_{t u} \phi_u(\mathbf{r}_2)
\end{equation}
We can get rid of the integral over spatial indices by using the orthonormality of the basis functions.
\begin{equation}
I_1 = \sum_{pq} \sum_{r} \sum_{t} \phi_p^*(\mathbf{r}_1) G_{p r} \phi_r(\mathbf{r}) \phi_r^*(\mathbf{r}) \Sigma_{r t} \phi_t(\mathbf{r}^\prime) \phi_t^*(\mathbf{r}^\prime) G_{t q} \phi_q(\mathbf{r}_2)
\end{equation}
We use this and then also rewrite equation \ref{eqninit_dm} in terms of elements of the density matrix with
\begin{equation}
D_{p q \sigma}=\left\langle p \sigma\left|\gamma^\sigma\right| q \sigma\right\rangle
\end{equation}
to get
\begin{equation}
    D_{p q \sigma}=\bra{p\sigma } \gamma _0^\sigma \ket{q\sigma } -\frac{\mathrm{i }}{2 \pi} \sum_{r} \sum_{t} \int_{-\infty }^{\infty } \mathrm{d} \omega \mathrm{e}^{\mathrm{i \omega \eta}} \bra{p\sigma } G_0^\sigma (\omega) \ket{r\sigma } \bra{r\sigma } \Sigma_c^\sigma (\omega) \ket{t\sigma } \bra{t\sigma } G_0^\sigma (\omega) \ket{q\sigma }.
\label{eqnmo_dm}
\end{equation}
Next, we plug in the following definitions for the two different time orderings for the noninteracting Green's function and correlation piece of the self energy
\begin{equation}
G_{0 pq}^\sigma=\sum_i \frac{\delta_{pq} \delta_{pi}}{\omega-\epsilon_{i\sigma}-\mathrm{i}\eta}+\sum_a \frac{\delta_{pq} \delta_{pa}}{\omega-\epsilon_{a\sigma}+\mathrm{i}\eta}
\end{equation}
and
\begin{equation}
\begin{aligned}
\Sigma_{c p q}^\sigma(\omega)= & \sum_{i s} \frac{w_{p i \sigma}^s w_{q i \sigma}^s}{\omega-\epsilon_{i \sigma}+\Omega_s-\mathrm{i} \eta} +\sum_{a s} \frac{w_{p a \sigma}^s w_{q a \sigma}^s}{\omega-\epsilon_{a \sigma}-\Omega_s+\mathrm{i} \eta}
\end{aligned}
\end{equation}
into equation \ref{eqnmo_dm} to get
\begin{equation}
\begin{aligned}
D_{p q \sigma}= & \bra{p\sigma } \gamma _0^\sigma \ket{q\sigma } -\frac{\mathrm{i }}{2 \pi} \sum_{r} \sum_{t} \int_{-\infty }^{\infty } \mathrm{d} \omega \mathrm{e}^{\mathrm{i \omega \eta}} \left( \sum_i \frac{\delta_{p r} \delta_{p i}}{\omega-\epsilon_{i \sigma}-\mathrm{i} \eta}+\sum_a \frac{\delta_{p r} \delta_{p a}}{\omega-\epsilon_{a \sigma}+\mathrm{i} \eta} \right)\\
& \left( \sum_{k s} \frac{w_{r k \sigma}^s w_{t k \sigma}^s}{\omega-\epsilon_{k \sigma}+\Omega_s-\mathrm{i} \eta} +\sum_{c s} \frac{w_{r c \sigma}^s w_{t c \sigma}^s}{\omega-\epsilon_{c \sigma}-\Omega_s+\mathrm{i} \eta} \right) \left( \sum_j \frac{\delta_{t q} \delta_{t j}}{\omega-\epsilon_{j \sigma}-\mathrm{i} \eta}+\sum_b \frac{\delta_{t q} \delta_{t b}}{\omega-\epsilon_{b \sigma}+\mathrm{i} \eta} \right).
\end{aligned}
\end{equation}
Let us distribute the integral, which spawns 8 terms. Also note that the delta functions will get rid of the sums over r and t
\begin{equation}
\begin{aligned}
I_2 = \int_{-\infty }^{\infty }\mathrm{d} \omega \mathrm{e}^{\mathrm{i \omega \eta}} 
& \left( \sum_{ijks} \left( \frac{w_{i k \sigma}^s w_{j k \sigma}^s}{(\omega-\epsilon_{k \sigma}+\Omega_s-\mathrm{i} \eta)(\omega-\epsilon_{i \sigma}-\mathrm{i} \eta)(\omega-\epsilon_{j \sigma}-\mathrm{i} \eta)} \right) \right.\\
& \left. + \sum_{ibks} \left( \frac{w_{i k \sigma}^s w_{b k \sigma}^s}{(\omega-\epsilon_{k \sigma}+\Omega_s-\mathrm{i} \eta)(\omega-\epsilon_{i \sigma}-\mathrm{i} \eta)(\omega-\epsilon_{b \sigma}+\mathrm{i} \eta)} \right) \right.\\
& \left. + \sum_{ijcs} \left( \frac{w_{i c \sigma}^s w_{j c \sigma}^s}{(\omega-\epsilon_{c \sigma}-\Omega_s+\mathrm{i} \eta)(\omega-\epsilon_{i \sigma}-\mathrm{i} \eta)(\omega-\epsilon_{j \sigma}-\mathrm{i} \eta)} \right) \right.\\
& \left. + \sum_{ibcs} \left( \frac{w_{i c \sigma}^s w_{b c \sigma}^s}{(\omega-\epsilon_{c \sigma}-\Omega_s+\mathrm{i} \eta)(\omega-\epsilon_{i \sigma}-\mathrm{i} \eta)(\omega-\epsilon_{b \sigma}+\mathrm{i} \eta)} \right) \right. \\
& \left. + \sum_{ajks} \left( \frac{w_{a k \sigma}^s w_{j k \sigma}^s}{(\omega-\epsilon_{k \sigma}+\Omega_s-\mathrm{i} \eta)(\omega-\epsilon_{a \sigma}+\mathrm{i} \eta)(\omega-\epsilon_{j \sigma}-\mathrm{i} \eta)} \right) \right.\\
& \left. + \sum_{abks} \left( \frac{w_{a k \sigma}^s w_{b k \sigma}^s}{(\omega-\epsilon_{k \sigma}+\Omega_s-\mathrm{i} \eta)(\omega-\epsilon_{a \sigma}+\mathrm{i} \eta)(\omega-\epsilon_{b \sigma}+\mathrm{i} \eta)} \right) \right.\\
& \left. + \sum_{ajcs} \left( \frac{w_{a c \sigma}^s w_{j c \sigma}^s}{(\omega-\epsilon_{c \sigma}-\Omega_s+\mathrm{i} \eta)(\omega-\epsilon_{a \sigma}+\mathrm{i} \eta)(\omega-\epsilon_{j \sigma}-\mathrm{i} \eta)} \right) \right.\\
& \left. + \sum_{abcs} \left( \frac{w_{a c \sigma}^s w_{b c \sigma}^s}{(\omega-\epsilon_{c \sigma}-\Omega_s+\mathrm{i} \eta)(\omega-\epsilon_{a \sigma}+\mathrm{i} \eta)(\omega-\epsilon_{b \sigma}+\mathrm{i} \eta)} \right) \right)
\label{eqnexpanded_integral}
\end{aligned}
\end{equation}
At this point, we note the following relation between integrals $\oint_{D_{\pm}} f(z) = \int_{-R}^R f(z) + \int_{{C_R}_{\pm}} f(z)$. $D_{\pm}$ is a semicircular domain in either half of the complex plane, ${C_R}_{\pm}$ is the semicircle in the upper or lower part of the complex plane, and $R$ is the radius of the semicircle. We are able to take $R\rightarrow \infty$ and since $f(z)=e^{i\omega \eta}g(z)$, where $g(z)$ is analytic on $D$ except for a finite number of poles, the integral over the semicircle will vanish by Jordan's lemma\autocite{JordanLemma}, leaving us with $\int_{-R=-\infty}^{R=\infty} f(z)= \oint_{D_{\pm}} f(z)$. 

\begin{figure}
    \centering
    \begin{tikzpicture}
    % Draw the axes
    \draw[->] (-4, 0) -- (4, 0) node[right] {Re($\omega$)};
    \draw[->] (0, -4) -- (0, 4) node[above] {Im($\omega$)};
    
    % Draw the positive real axis label and tick mark for \varepsilon_{F}
    \draw[thick] (0.5, 0.2) -- (0.5, -0.2);
    \node at (0.5, -0.4) {$\varepsilon_{F}$};


    % Draw the semicircle contours
    % fill in its under side
    \fill[blue, opacity=0.3] (4, 0.1) arc[start angle=0, end angle=180, radius=4];
    \fill[red, opacity=0.3] (4, -0.1) arc[start angle=0, end angle=-180, radius=4];
    
    % Draw the poles above the real axis
    \foreach \x in {-3,-2,-1,0} {
        \draw[fill=black] (\x, 0.5) circle (2pt);
    }
    \node at (-3, 0.7) {$\omega_{}$};
    \node at (-2, 0.7) {$\omega_{}$};
    \node at (-1, 0.7) {$\omega_{}$};
    \node at (0, 0.7) {$\omega_{}$};    

    % Draw the poles below the real axis
    \foreach \x in {1,2,3,4} {
        \draw[fill=black] (\x, -0.5) -- ++(0.1, 0.1) -- ++(-0.2, 0) -- cycle;
    }
    \node at (1, -0.7) {$\omega_{}$};
    \node at (2, -0.7) {$\omega_{}$};
    \node at (3, -0.7) {$\omega_{}$};
    \node at (4, -0.7) {$\omega_{}$};

    
    % Label the contours
    \node at (2, 2) {$D_+$};
    \node at (-2, -2) {$D_-$};
\end{tikzpicture}
\caption{Contour for the complex frequency integral. The poles are denoted by the various $\omega$. The Fermi energy is denoted by $\varepsilon_F$. The integration contour $D_+$ is the semicircle in the upper complex plane, while $D_-$ is the semicircle in the lower complex plane.}
\end{figure}


\section{Fully occupied block}
The contribution over the fully occupied block of the density matrix will be given by the following two terms in equation \ref{eqnexpanded_integral}
\begin{equation}
\begin{aligned}
I_{ij} =& \sum_{ks} w_{i k \sigma}^s w_{j k \sigma}^s \oint_{D+} \mathrm{d} \omega \mathrm{e}^{\mathrm{i \omega \eta}} \frac{1}{(\omega-\epsilon_{k \sigma}+\Omega_s-\mathrm{i} \eta)(\omega-\epsilon_{i \sigma}-\mathrm{i} \eta)(\omega-\epsilon_{j \sigma}-\mathrm{i} \eta)}\\
& + \sum_{cs} w_{i c \sigma}^s w_{j c \sigma}^s \oint_{D+} \mathrm{d} \omega \mathrm{e}^{\mathrm{i \omega \eta}} \frac{1}{(\omega-\epsilon_{c \sigma}-\Omega_s+\mathrm{i} \eta)(\omega-\epsilon_{i \sigma}-\mathrm{i} \eta)(\omega-\epsilon_{j \sigma}-\mathrm{i} \eta)}
\end{aligned}
.
\end{equation}
Due to the contour $D_+$ chosen for this case, we have poles for the first term at $\omega_{11} = \epsilon _{k\sigma } - \Omega _s + \mathrm{i} \eta$, $\omega_{12} = \epsilon _{i\sigma } + \mathrm{i} \eta$, and $\omega_{13} = \epsilon _{j\sigma } + \mathrm{i} \eta$. For such simple poles, the Cauchy residue theorem simplifies to
\begin{equation}
\operatorname{Res}_{\omega =\omega _0} f(\omega )= \phi^{}\left(\omega _0\right)
\label{eqncauchy_residue}
\end{equation}
where $\phi_{\omega _0}(\omega ) = (\omega - \omega_0) f(\omega )$. For the first of these integrals in the occupied block, we have
\begin{equation}
f_1(\omega) = \frac{e^{i\omega \eta }}{(\omega-\epsilon_{k \sigma}+\Omega_s-\mathrm{i} \eta)(\omega-\epsilon_{i \sigma}-\mathrm{i} \eta)(\omega-\epsilon_{j \sigma}-\mathrm{i} \eta)}.
\end{equation}
% Plugging in $\omega_{11} = \epsilon _{k\sigma } - \Omega _s + \mathrm{i} \eta$, we get
% \begin{equation}
% \phi_{\omega_{11}}(\omega) = (\omega - \epsilon_{k \sigma} + \Omega_s - \mathrm{i} \eta) f_1(\omega) = \frac{e^{i\omega \eta }}{(\omega-\epsilon_{i \sigma}-\mathrm{i} \eta)(\omega-\epsilon_{j \sigma}-\mathrm{i} \eta)}
% \end{equation}
So at the first pole, in the limit $\eta \to 0$, we get
\begin{equation}
\phi_{\omega_{11}}(\epsilon_{k \sigma} - \Omega_s + \mathrm{i} \eta) = \frac{1}{(\epsilon_{k \sigma} - \Omega_s -\epsilon_{i \sigma})(\epsilon_{k \sigma} - \Omega_s -\epsilon_{j \sigma})}
\end{equation}
For the other poles, the procedure is similar with
\begin{equation}
\phi_{\omega_{12}}(\epsilon_{i \sigma} + \mathrm{i} \eta) = \frac{1}{(\epsilon_{i \sigma} -\epsilon_{k \sigma}+\Omega_s)(\epsilon_{i \sigma} -\epsilon_{j \sigma})}
\end{equation}
and
\begin{equation}
\phi_{\omega_{13}}(\epsilon_{j \sigma} + \mathrm{i} \eta) = \frac{1}{(\epsilon_{j \sigma} -\epsilon_{k \sigma}+\Omega_s)(\epsilon_{j \sigma} -\epsilon_{i \sigma})}.
\end{equation}
We move on to the second integral in the occupied block. It only has two poles in the fully occupied contour $\omega_{21} = \epsilon _{i\sigma } + \mathrm{i} \eta$ and $\omega_{22} = \epsilon _{j\sigma } + \mathrm{i} \eta$. We have $f_2(\omega)$ as
\begin{equation}
f_2(\omega) = \frac{e^{i\omega \eta }}{(\omega-\epsilon_{c \sigma}-\Omega_s+\mathrm{i} \eta)(\omega-\epsilon_{i \sigma}-\mathrm{i} \eta)(\omega-\epsilon_{j \sigma}-\mathrm{i} \eta)}.
\end{equation}
So $\phi_{\omega_{21}}(\omega _{21})$ is
\begin{equation}
\phi_{\omega_{21}}(\epsilon_{i \sigma} + \mathrm{i} \eta) = \frac{1}{(\epsilon_{i \sigma} -\epsilon_{c \sigma}-\Omega_s)(\epsilon_{i \sigma} -\epsilon_{j \sigma})}.
\end{equation}
Now we consider the second pole at $\omega_{22} = \epsilon _{j\sigma } + \mathrm{i} \eta$
\begin{equation}
\phi_{\omega_{22}}(\epsilon_{j \sigma} + \mathrm{i} \eta) = \frac{1}{(\epsilon_{j \sigma} -\epsilon_{c \sigma}-\Omega_s)(\epsilon_{j \sigma} -\epsilon_{i \sigma})}.
\end{equation}
We summarize the results in a table \ref{tabpoles_residues_occupied}.\\
\begin{table}[h]
\centering
\caption{Occupied block Poles and their Residues}
\begin{tabular}{|c|c|c|}
\hline
Pole Notation & Position $\omega_0$ & Residue $\phi_{\omega_0}(\omega_0)$ \\
\hline
\multicolumn{3}{|c|}{Series $\omega_1$} \\
\hline
$\omega_{11}$ & $\epsilon_{k \sigma} - \Omega_s + \mathrm{i} \eta$ & $\frac{1}{(\epsilon_{k \sigma} - \Omega_s -\epsilon_{i \sigma})(\epsilon_{k \sigma} - \Omega_s -\epsilon_{j \sigma})}$ \\
$\omega_{12}$ & $\epsilon_{i \sigma} + \mathrm{i} \eta$ & $\frac{1}{(\epsilon_{i \sigma} -\epsilon_{k \sigma}+\Omega_s)(\epsilon_{i \sigma} -\epsilon_{j \sigma})}$ \\
$\omega_{13}$ & $\epsilon_{j \sigma} + \mathrm{i} \eta$ & $\frac{1}{(\epsilon_{j \sigma} -\epsilon_{k \sigma}+\Omega_s)(\epsilon_{j \sigma} -\epsilon_{i \sigma})}$ \\
\hline
\multicolumn{3}{|c|}{Series $\omega_2$} \\
\hline
$\omega_{21}$ & $\epsilon_{i \sigma} + \mathrm{i} \eta$ & $\frac{1}{(\epsilon_{i \sigma} -\epsilon_{c \sigma}-\Omega_s)(\epsilon_{i \sigma} -\epsilon_{j \sigma})}$ \\
$\omega_{22}$ & $\epsilon_{j \sigma} + \mathrm{i} \eta$ & $\frac{1}{(\epsilon_{j \sigma} -\epsilon_{c \sigma}-\Omega_s)(\epsilon_{j \sigma} -\epsilon_{i \sigma})}$ \\
\hline
\label{tabpoles_residues_occupied}
\end{tabular}
\end{table}
Adding the two terms together, we get
\begin{equation}
\begin{aligned}
I_{ij} = 2\pi i \Bigg( & \sum_{ks} w_{i k \sigma}^s w_{j k \sigma}^s \left( \frac{1}{(\epsilon_{k \sigma} - \Omega_s - \epsilon_{i \sigma})(\epsilon_{k \sigma} - \Omega_s - \epsilon_{j \sigma})} + \frac{1}{(\epsilon_{i \sigma} - \epsilon_{k \sigma} + \Omega_s)(\epsilon_{i \sigma} - \epsilon_{j \sigma})} \right. \\
& \left. + \frac{1}{(\epsilon_{j \sigma} - \epsilon_{k \sigma} + \Omega_s)(\epsilon_{j \sigma} - \epsilon_{i \sigma})} \right) \\
& + \sum_{cs} w_{i c \sigma}^s w_{j c \sigma}^s \left( \frac{1}{(\epsilon_{i \sigma} - \epsilon_{c \sigma} - \Omega_s)(\epsilon_{i \sigma} - \epsilon_{j \sigma})} + \frac{1}{(\epsilon_{j \sigma} - \epsilon_{c \sigma} - \Omega_s)(\epsilon_{j \sigma} - \epsilon_{i \sigma})} \right) \Bigg).
\end{aligned}
\end{equation}
Getting a common denominator for all of the terms means that the first term simplifies to 0, and the second term gives
\begin{equation}
I_{ij} = -2\pi i \sum_{cs}\frac{w_{i c \sigma}^s w_{j c \sigma}^s}{(\Omega_s + \epsilon_{c \sigma} - \epsilon_{i \sigma})(\Omega_s + \epsilon_{c \sigma} - \epsilon_{j \sigma})}.
\end{equation}
So, the expression for the fully occupied block of the density matrix is
\begin{equation}
D_{ij} = \bra{i\sigma } \gamma _0^\sigma \ket{j\sigma } + \frac{2\pi i^2}{2\pi} \sum_{cs}\frac{w_{ic} w_{jc}}{(\Omega_s + \epsilon_{c \sigma} - \epsilon_{i \sigma})(\Omega_s + \epsilon_{c \sigma} - \epsilon_{j \sigma})}.
\end{equation}
The first term is the fully occupied element of the noninteracting density matrix, so this just reduces to $\delta _{ij}$ since for this reference system, the occupied occupations are just unity and then we relabel the virtual index $c\rightarrow a$.
\begin{equation}
D_{ij} = \delta _{ij} - \sum_{as}\frac{w_{ia} w_{ja}}{(\Omega_s + \epsilon_{a \sigma} - \epsilon_{i \sigma})(\Omega_s + \epsilon_{a \sigma} - \epsilon_{j \sigma})}.
\end{equation}
\section{Fully Virtual Block}
For the fully virtual block, we need to consider third to last and last terms of the integral in equation \ref{eqnexpanded_integral}
\begin{equation}
\begin{aligned}
I_{ab} =& \sum_{ks} w_{a k \sigma}^s w_{b k \sigma}^s \int \mathrm{d} \omega \mathrm{e}^{\mathrm{i \omega \eta}} \frac{1}{(\omega-\epsilon_{k \sigma}+\Omega_s-\mathrm{i} \eta)(\omega-\epsilon_{a \sigma}+\mathrm{i} \eta)(\omega-\epsilon_{b \sigma}+\mathrm{i} \eta)}\\
& + \sum_{cs} w_{a c \sigma}^s w_{b c \sigma}^s \int \mathrm{d} \omega \mathrm{e}^{\mathrm{i \omega \eta}} \frac{1}{(\omega-\epsilon_{c \sigma}-\Omega_s+\mathrm{i} \eta)(\omega-\epsilon_{a \sigma}+\mathrm{i} \eta)(\omega-\epsilon_{b \sigma}+\mathrm{i} \eta)}
\end{aligned}
\end{equation}
Due to the contour $D_-$ chosen for this case, we have poles for the first term at just $\omega_{11} = \epsilon _{a \sigma } - \mathrm{i} \eta$ and $\omega_{12} = \epsilon _{b \sigma } - \mathrm{i} \eta$. Using the Cauchy residue theorem from equation \ref{eqncauchy_residue}
\begin{equation}
f_1(\omega) = \frac{e^{i\omega \eta }}{(\omega-\epsilon_{k \sigma}+\Omega_s-\mathrm{i} \eta)(\omega-\epsilon_{a \sigma}+\mathrm{i} \eta)(\omega-\epsilon_{b \sigma}+\mathrm{i} \eta)}.    
\end{equation}
Plugging in $\omega_{11} = \epsilon _{a \sigma } - \mathrm{i} \eta$, we get
\begin{equation}
\phi_{\omega_{11}}(\epsilon_{a \sigma} - \mathrm{i} \eta) = \frac{1}{(\epsilon_{a \sigma} -\epsilon_{k \sigma}+\Omega_s)(\epsilon_{a \sigma} -\epsilon_{b \sigma})}.    
\end{equation}
and
\begin{equation}
\phi_{\omega_{12}}(\epsilon_{b \sigma} - \mathrm{i} \eta) = \frac{1}{(\epsilon_{b \sigma} -\epsilon_{k \sigma}+\Omega_s)(\epsilon_{b \sigma} -\epsilon_{a \sigma})}.    
\end{equation}
We move on to the second integral in the virtual block. It has now three poles in $D_-$ $\omega_{21} = \epsilon _{c\sigma } + \Omega_s - \mathrm{i} \eta$, $\omega_{22} = \epsilon _{a\sigma } - \mathrm{i} \eta$, and $\omega_{23} = \epsilon _{b\sigma } - \mathrm{i} \eta$. We have $f_2(\omega)$ as
\begin{equation}
f_2(\omega) = \frac{e^{i\omega \eta }}{(\omega-\epsilon_{c \sigma}-\Omega_s+\mathrm{i} \eta)(\omega-\epsilon_{a \sigma}+\mathrm{i} \eta)(\omega-\epsilon_{b \sigma}+\mathrm{i} \eta)}.
\end{equation}
So $\phi_{\omega_{21}}(\omega _{21})$ is
\begin{equation}
\phi_{\omega_{21}}(\epsilon_{c \sigma} + \Omega_s - \mathrm{i} \eta) = \frac{1}{(\epsilon_{c \sigma} + \Omega_s -\epsilon_{a \sigma})(\epsilon_{c \sigma} + \Omega_s -\epsilon_{b \sigma})}.
\end{equation}
Now we consider the second pole at $\omega_{22} = \epsilon _{a\sigma } - \mathrm{i} \eta$
\begin{equation}
\phi_{\omega_{22}}(\epsilon_{a \sigma} - \mathrm{i} \eta) = \frac{1}{(\epsilon_{a \sigma} -\epsilon_{c \sigma}-\Omega_s)(\epsilon_{a \sigma} -\epsilon_{b \sigma})}.
\end{equation}
Finally, we consider the third pole at $\omega_{23} = \epsilon _{b\sigma } - \mathrm{i} \eta$
\begin{equation}
\phi_{\omega_{23}}(\epsilon_{b \sigma} - \mathrm{i} \eta) = \frac{1}{(\epsilon_{b \sigma} -\epsilon_{c \sigma}-\Omega_s)(\epsilon_{b \sigma} -\epsilon_{a \sigma})}.
\end{equation}
The results we got are summarized in the table \ref{tabpoles_residues_virtual}.\\
\begin{table}[h]
\centering
\caption{Virtual block Poles and their Residues}
\begin{tabular}{|c|c|c|}
\hline
Pole Notation & Position $\omega_0$ & Residue $\phi_{\omega_0}(\omega_0)$ \\
\hline
\multicolumn{3}{|c|}{Series $\omega_1$} \\
\hline
$\omega_{11}$ & $\epsilon_{a \sigma} - \mathrm{i} \eta$ & $\frac{1}{(\epsilon_{a \sigma} -\epsilon_{k \sigma}+\Omega_s)(\epsilon_{a \sigma} -\epsilon_{b \sigma})}$ \\
$\omega_{12}$ & $\epsilon_{b \sigma} - \mathrm{i} \eta$ & $\frac{1}{(\epsilon_{b \sigma} -\epsilon_{k \sigma}+\Omega_s)(\epsilon_{b \sigma} -\epsilon_{a \sigma})}$ \\
\hline
\multicolumn{3}{|c|}{Series $\omega_2$} \\
\hline
$\omega_{21}$ & $\epsilon_{c \sigma} + \Omega_s - \mathrm{i} \eta$ & $\frac{1}{(\epsilon_{c \sigma} + \Omega_s -\epsilon_{a \sigma})(\epsilon_{c \sigma} + \Omega_s -\epsilon_{b \sigma})}$ \\
$\omega_{22}$ & $\epsilon_{a \sigma} - \mathrm{i} \eta$ & $\frac{1}{(\epsilon_{a \sigma} -\epsilon_{c \sigma}-\Omega_s)(\epsilon_{a \sigma} -\epsilon_{b \sigma})}$ \\
$\omega_{23}$ & $\epsilon_{b \sigma} - \mathrm{i} \eta$ & $\frac{1}{(\epsilon_{b \sigma} -\epsilon_{c \sigma}-\Omega_s)(\epsilon_{b \sigma} -\epsilon_{a \sigma})}$ \\
\hline
\label{tabpoles_residues_virtual}
\end{tabular}
\end{table}
Adding the two terms together, we get
\begin{equation}
\begin{aligned}
I_{ab} = 2\pi i \Bigg( & \sum_{ks} w_{a k \sigma}^s w_{b k \sigma}^s \left( \frac{1}{(\epsilon_{a \sigma} -\epsilon_{k \sigma}+\Omega_s)(\epsilon_{a \sigma} -\epsilon_{b \sigma})} + \frac{1}{(\epsilon_{b \sigma} -\epsilon_{k \sigma}+\Omega_s)(\epsilon_{b \sigma} -\epsilon_{a \sigma})} \right) \\
& + \sum_{cs} w_{a c \sigma}^s w_{b c \sigma}^s \left( \frac{1}{(\epsilon_{c \sigma} + \Omega_s -\epsilon_{a \sigma})(\epsilon_{c \sigma} + \Omega_s -\epsilon_{b \sigma})} \right. \\
& \left. + \frac{1}{(\epsilon_{a \sigma} -\epsilon_{c \sigma}-\Omega_s)(\epsilon_{a \sigma} -\epsilon_{b \sigma})} \right. \\
& \left. + \frac{1}{(\epsilon_{b \sigma} -\epsilon_{c \sigma}-\Omega_s)(\epsilon_{b \sigma} -\epsilon_{a \sigma})} \right) \Bigg)
\end{aligned}
.
\end{equation}
A similar simplification as the one done before, which involves getting a common denominator, gives
\begin{equation}
I_{ab} = -2\pi i \sum_{ks}\frac{w_{ak} w_{bk}}{(\Omega_s + \epsilon_{k \sigma} - \epsilon_{a \sigma})(\Omega_s + \epsilon_{k \sigma} - \epsilon_{b \sigma})}.
\end{equation}
So, the expression for $D_{ab}$ is
\begin{equation}
D_{ab} = \bra{a\sigma } \gamma _0^\sigma \ket{b\sigma } + \frac{2\pi i^2}{2\pi} \sum_{ks}\frac{w_{ak} w_{bk}}{(\Omega_s + \epsilon_{k \sigma} - \epsilon_{a \sigma})(\Omega_s + \epsilon_{k \sigma} - \epsilon_{b \sigma})}.
\end{equation}
The noninteracting density matrix does not mix virtual states and we relabel the occupied index $k\rightarrow i$, to get
\begin{equation}
D_{ab} = - \sum_{is}\frac{w_{ai} w_{bi}}{(\Omega_s + \epsilon_{i \sigma} - \epsilon_{a \sigma})(\Omega_s + \epsilon_{i \sigma} - \epsilon_{b \sigma})}.
\end{equation}
\section{Mixed Block}
Now, we want to consider one instance of the mixed block i.e. the second and fourth terms of the integral in equation \ref{eqnexpanded_integral}
\begin{equation}
\begin{aligned}
I_{ib} =& \sum_{ks} w_{i k \sigma}^s w_{b k \sigma}^s \int \mathrm{d} \omega \mathrm{e}^{\mathrm{i \omega \eta}} \frac{1}{(\omega-\epsilon_{k \sigma}+\Omega_s-\mathrm{i} \eta)(\omega-\epsilon_{i \sigma}-\mathrm{i} \eta)(\omega-\epsilon_{b \sigma}+\mathrm{i} \eta)}\\
& + \sum_{cs} w_{i c \sigma}^s w_{b c \sigma}^s \int \mathrm{d} \omega \mathrm{e}^{\mathrm{i \omega \eta}} \frac{1}{(\omega-\epsilon_{c \sigma}-\Omega_s+\mathrm{i} \eta)(\omega-\epsilon_{i \sigma}-\mathrm{i} \eta)(\omega-\epsilon_{b \sigma}+\mathrm{i} \eta)}
\end{aligned}
.
\end{equation}
Due to the contour $D_+$ chosen for this case, we have poles for the first term which lies in the upper half of the complex plane at $\omega_{11} = \epsilon _{k \sigma } - \Omega_s + \mathrm{i} \eta$ and $\omega_{12} = \epsilon _{i \sigma } + \mathrm{i} \eta$.
Using the Cauchy residue theorem from equation \ref{eqncauchy_residue}
\begin{equation}
f_1(\omega) = \frac{e^{i\omega \eta }}{(\omega-\epsilon_{k \sigma}+\Omega_s-\mathrm{i} \eta)(\omega-\epsilon_{i \sigma}+\mathrm{i} \eta)(\omega-\epsilon_{b \sigma}+\mathrm{i} \eta)}.
\end{equation}
Plugging in $\omega_{11} = \epsilon _{k \sigma } - \Omega_s + \mathrm{i} \eta$, we get
\begin{equation}
\phi_{\omega_{11}}(\epsilon_{k \sigma } - \Omega_s + \mathrm{i} \eta) = \frac{1}{(\epsilon_{k \sigma} -\epsilon_{i \sigma}-\Omega_s)(\epsilon_{k \sigma} -\epsilon_{b \sigma}-\Omega_s)}.
\end{equation}
Now we consider the second pole at $\omega_{12} = \epsilon _{i \sigma } + \mathrm{i} \eta$
\begin{equation}
\phi_{\omega_{12}}(\epsilon_{i \sigma} + \mathrm{i} \eta) = \frac{1}{(\epsilon_{i \sigma} -\epsilon_{k \sigma}+\Omega_s)(\epsilon_{i \sigma} -\epsilon_{b \sigma})}.
\end{equation}
We move on to the second integral in the mixed block. It has two poles in $D_-$ $\omega_{21} = \epsilon _{c\sigma } + \Omega_s - \mathrm{i} \eta$ and $\omega_{22} = \epsilon _{b \sigma } - \mathrm{i} \eta$. We have $f_2(\omega)$ as
\begin{equation}
f_2(\omega) = \frac{e^{i\omega \eta }}{(\omega-\epsilon_{c \sigma}-\Omega_s+\mathrm{i} \eta)(\omega-\epsilon_{i \sigma}-\mathrm{i} \eta)(\omega-\epsilon_{b \sigma}+\mathrm{i} \eta)}.
\end{equation}
So $\phi_{\omega_{21}}(\omega _{21})$ is
\begin{equation}
{\phi_{\omega_{21}}(\epsilon_{c \sigma} + \Omega_s - \mathrm{i} \eta) = \frac{1}{(\epsilon_{c \sigma} + \Omega_s -\epsilon_{i \sigma})(\epsilon_{c \sigma} + \Omega_s -\epsilon_{b \sigma})}}.
\end{equation}
Now we consider the second pole at $\omega_{22} = \epsilon _{b \sigma } - \mathrm{i} \eta$
\begin{equation}
{\phi_{\omega_{22}}(\epsilon_{b \sigma} - \mathrm{i} \eta) = \frac{1}{(\epsilon_{b \sigma} -\epsilon_{c \sigma}-\Omega_s)(\epsilon_{b \sigma} -\epsilon_{i \sigma})}}.
\end{equation}
The results we got are summarized in the table \ref{tabpoles_residues_mixed}.\\
\begin{table}[h]
\centering
\caption{Mixed block Poles and their Residues}
\begin{tabular}{|c|c|c|}
\hline
Pole Notation & Position $\omega_0$ & Residue $\phi_{\omega_0}(\omega_0)$ \\
\hline
\multicolumn{3}{|c|}{Series $\omega_1$} \\
\hline
$\omega_{11}$ & $\epsilon_{k \sigma} - \Omega_s + \mathrm{i} \eta$ & $\frac{1}{(\epsilon_{k \sigma} -\epsilon_{i \sigma}-\Omega_s)(\epsilon_{k \sigma} -\epsilon_{b \sigma}-\Omega_s)}$ \\
$\omega_{12}$ & $\epsilon_{i \sigma} + \mathrm{i} \eta$ & $\frac{1}{(\epsilon_{i \sigma} -\epsilon_{k \sigma}+\Omega_s)(\epsilon_{i \sigma} -\epsilon_{b \sigma})}$ \\
\hline
\multicolumn{3}{|c|}{Series $\omega_2$} \\
\hline
$\omega_{21}$ & $\epsilon_{c \sigma} + \Omega_s - \mathrm{i} \eta$ & $\frac{1}{(\epsilon_{c \sigma} + \Omega_s -\epsilon_{i \sigma})(\epsilon_{c \sigma} + \Omega_s -\epsilon_{b \sigma})}$ \\
$\omega_{22}$ & $\epsilon_{b \sigma} - \mathrm{i} \eta$ & $\frac{1}{(\epsilon_{b \sigma} -\epsilon_{c \sigma}-\Omega_s)(\epsilon_{b \sigma} -\epsilon_{i \sigma})}$ \\
\hline
\label{tabpoles_residues_mixed}
\end{tabular}
\end{table}
Adding the two terms together, we get
\begin{equation}
\begin{aligned}
I_{ib} = 2\pi i \Bigg( & \sum_{ks} w_{i k \sigma}^s w_{b k \sigma}^s \left( \frac{1}{(\epsilon_{k \sigma} -\epsilon_{i \sigma}-\Omega_s)(\epsilon_{k \sigma} -\epsilon_{b \sigma}-\Omega_s)} \right. \\
& \left. + \frac{1}{(\epsilon_{i \sigma} -\epsilon_{k \sigma}+\Omega_s)(\epsilon_{i \sigma} -\epsilon_{b \sigma})} \right) \\
& + \sum_{cs} w_{i c \sigma}^s w_{b c \sigma}^s \left( \frac{1}{(\epsilon_{c \sigma} + \Omega_s -\epsilon_{i \sigma})(\epsilon_{c \sigma} + \Omega_s -\epsilon_{b \sigma})} \right. \\
& \left. + \frac{1}{(\epsilon_{b \sigma} -\epsilon_{c \sigma}-\Omega_s)(\epsilon_{b \sigma} -\epsilon_{i \sigma})} \right) \Bigg)
\end{aligned}
.
\end{equation}
By getting a common denominator and simplifying terms, we get
\begin{equation}
D_{ib} = \bra{i\sigma } \gamma _0^\sigma \ket{b\sigma } + \frac{2\pi i^2}{2\pi\left( \epsilon _{i\sigma } - \epsilon _{b\sigma } \right)} \left[ \sum_{ks} \frac{w_{ik}^s w_{bk}^s}{\epsilon _{k\sigma } - \epsilon _{b\sigma } - \Omega _s} - \sum_{cs} \frac{w_{ic}^s w_{bc}^s}{\epsilon _{c \sigma} + \Omega _s - \epsilon _{i\sigma}} \right].
\end{equation}
The noninteracting density matrix does not mix occupied with virtual states and we relabel the occupied index $k\rightarrow j$ and the virtual index $c\rightarrow a$
\begin{equation}
D_{ib} = \frac{1}{\epsilon _{i\sigma } - \epsilon _{b\sigma }} \left[ \sum_{as} \frac{w_{ia}^s w_{ba}^s}{\epsilon _{i\sigma } - \epsilon _{a\sigma } - \Omega _s} - \sum_{js} \frac{w_{ij}^s w_{bj}^s}{\epsilon _{j\sigma } - \epsilon _{b\sigma } - \Omega _s} \right].
\end{equation}
Interestingly, for the mixed block, the result you get is exactly the same if you choose the opposite contour $D_-$ for the full frequency integral of \ref{eqnexpanded_integral}. This is what one would expect from an interpretation of Jordan's Lemma. 




\printindex


%% Pocket materials at the VERY END of thesis


\end{document}
